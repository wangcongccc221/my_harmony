# 折线图数据传入接口说明

## 概述

`DataTablesTabBar` 组件提供了多种方式向折线图传入数据，支持：
- 单个数据点追加
- 批量数据追加
- 完整数据覆盖
- 清空数据
- 启用/禁用自动数据生成

## 接口方法

### 1. `appendLineChartData(value: number, label: string)`

**功能**：追加单个数据点到折线图

**参数**：
- `value: number` - 数据值（如 50, 75.5）
- `label: string` - 时间标签（如 "09:30", "10:15"）

**示例**：
```typescript
// 在父组件中获取 DataTablesTabBar 的引用
@State dataTablesTabBarRef: DataTablesTabBar | null = null

// 追加单个数据点
this.dataTablesTabBarRef?.appendLineChartData(65, "09:30")
this.dataTablesTabBarRef?.appendLineChartData(72, "09:31")
```

**使用场景**：
- 实时数据流（传感器数据、网络数据等）
- 定时采集数据
- 用户手动输入数据

---

### 2. `appendLineChartDataBatch(data: number[], labels: string[])`

**功能**：批量追加数据点到折线图

**参数**：
- `data: number[]` - 数据值数组
- `labels: string[]` - 时间标签数组（长度需与 data 相同）

**示例**：
```typescript
// 批量追加数据
const values = [50, 55, 60, 65, 70]
const times = ["09:00", "09:01", "09:02", "09:03", "09:04"]
this.dataTablesTabBarRef?.appendLineChartDataBatch(values, times)
```

**使用场景**：
- 从数据库批量加载历史数据
- 从文件读取数据
- 从API接口获取数据数组

---

### 3. `setLineChartData(data: number[], labels: string[])`

**功能**：设置折线图的完整数据（覆盖模式，清空旧数据）

**参数**：
- `data: number[]` - 数据值数组（最多60个，超出部分会被截断）
- `labels: string[]` - 时间标签数组（长度需与 data 相同）

**示例**：
```typescript
// 完全替换现有数据
const newData = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]
const newLabels = ["08:00", "08:10", "08:20", "08:30", "08:40", 
                   "08:50", "09:00", "09:10", "09:20", "09:30"]
this.dataTablesTabBarRef?.setLineChartData(newData, newLabels)
```

**使用场景**：
- 切换数据源时完全替换
- 重新加载数据
- 初始化图表数据

**注意**：
- 最多支持60个数据点，超出部分会被自动截断
- 会清空所有旧数据

---

### 4. `clearLineChartData()`

**功能**：清空折线图所有数据

**示例**：
```typescript
// 清空图表
this.dataTablesTabBarRef?.clearLineChartData()
```

**使用场景**：
- 重置图表
- 切换数据源前清空
- 用户手动清空操作

---

### 5. `setAutoDataGeneration(enabled: boolean)`

**功能**：启用/禁用自动数据生成（模拟数据）

**参数**：
- `enabled: boolean` - `true`=启用自动生成，`false`=禁用

**示例**：
```typescript
// 禁用自动数据生成（使用外部数据）
this.dataTablesTabBarRef?.setAutoDataGeneration(false)

// 启用自动数据生成（恢复模拟数据）
this.dataTablesTabBarRef?.setAutoDataGeneration(true)
```

**使用场景**：
- 使用外部数据源时，需要先禁用自动生成
- 测试时启用模拟数据

---

## 完整使用示例

### 示例1：从HTTP API获取数据

```typescript
// 在父组件中
@State dataTablesTabBarRef: DataTablesTabBar | null = null

async loadDataFromAPI() {
  // 禁用自动数据生成
  this.dataTablesTabBarRef?.setAutoDataGeneration(false)
  
  try {
    const response = await fetch('http://your-api.com/chart-data')
    const json = await response.json()
    
    // 设置完整数据
    this.dataTablesTabBarRef?.setLineChartData(
      json.values,  // number[]
      json.labels   // string[]
    )
  } catch (error) {
    console.error('加载数据失败:', error)
  }
}
```

### 示例2：实时数据流（WebSocket/TCP）

```typescript
// 在父组件中
@State dataTablesTabBarRef: DataTablesTabBar | null = null

onWebSocketMessage(message: any) {
  // 禁用自动数据生成
  this.dataTablesTabBarRef?.setAutoDataGeneration(false)
  
  // 实时追加数据点
  this.dataTablesTabBarRef?.appendLineChartData(
    message.value,
    message.timestamp  // 如 "09:30:15"
  )
}
```

### 示例3：从数据库加载历史数据

```typescript
async loadHistoryFromDatabase() {
  // 禁用自动数据生成
  this.dataTablesTabBarRef?.setAutoDataGeneration(false)
  
  // 从数据库查询
  const rows = await ArkDataDemoService.queryAllProcessing()
  
  // 转换为图表数据格式
  const values: number[] = []
  const labels: string[] = []
  
  rows.forEach(row => {
    values.push(row.totalWeight)
    labels.push(row.startTime.substring(11, 16))  // 提取 "HH:MM"
  })
  
  // 批量设置数据
  this.dataTablesTabBarRef?.setLineChartData(values, labels)
}
```

### 示例4：定时采集数据

```typescript
startDataCollection() {
  // 禁用自动数据生成
  this.dataTablesTabBarRef?.setAutoDataGeneration(false)
  
  // 定时采集
  setInterval(() => {
    const value = this.readSensorValue()  // 读取传感器值
    const label = new Date().toTimeString().substring(0, 5)  // "HH:MM"
    
    this.dataTablesTabBarRef?.appendLineChartData(value, label)
  }, 1000)  // 每秒采集一次
}
```

---

## 注意事项

1. **数据量限制**：最多支持60个数据点，超出部分会被自动覆盖（环形缓冲区）

2. **自动生成冲突**：使用外部数据时，建议先调用 `setAutoDataGeneration(false)` 禁用自动生成

3. **数据格式**：
   - `value` 必须是 `number` 类型
   - `label` 建议使用 "HH:MM" 格式（如 "09:30"），但可以是任意字符串

4. **性能优化**：
   - 单个数据点追加：适合实时流数据
   - 批量追加：适合一次性加载多条数据
   - 完整覆盖：适合切换数据源或重新加载

5. **线程安全**：所有方法都是同步的，可以在任何线程调用

---

## 在组件中使用

在父组件中获取 `DataTablesTabBar` 的引用：

```typescript
@Entry
@Component
struct HomePage {
  @State dataTablesTabBarRef: DataTablesTabBar | null = null
  
  build() {
    Column() {
      DataTablesTabBar({
        // ... 其他属性
      })
      .ref((ref: DataTablesTabBar) => {
        this.dataTablesTabBarRef = ref
      })
    }
  }
}
```

然后就可以通过 `this.dataTablesTabBarRef` 调用上述所有方法了。

