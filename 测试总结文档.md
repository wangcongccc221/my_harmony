# 测试总结文档

## 一、K6 压力测试（15 分钟）

- 测试脚本：`playwright-tests/k6-load-test.js`
- 目标地址：`http://127.0.0.1:8080`（可用 `BASE_URL` 覆盖）
- 端口映射：`hdc fport tcp:8080 tcp:8080`
- 场景配置：1m 预热 + 13m 稳态 + 1m 降载，最大 10 VUs，70% 列表/30% 插入，每次迭代 `sleep(1)`

### 1. 执行命令
```powershell
cd .\playwright-tests
$env:BASE_URL="http://127.0.0.1:8080"
npx k6 run k6-load-test.js
```

### 2. 关键输出（原始摘要）
```text
execution: local
  script: k6-load-test.js
  output: -

scenarios: (100.00%) 1 scenario, 10 max VUs, 15m30s max duration (incl. graceful stop):
           * default: Up to 10 looping VUs for 15m0s over 3 stages (gracefulRampDown: 30s, gracefulStop: 30s)

THRESHOLDS
  http_req_duration
  ✓ 'p(95)<1500' p(95)=210.19ms

  http_req_failed
  ✓ 'rate<0.05' rate=0.00%

TOTAL RESULTS
  checks_total.......: 7788    8.649978/s
  checks_succeeded...: 100.00% 7788 out of 7788
  checks_failed......: 0.00%   0 out of 7788

  ✓ ok

  HTTP
  http_req_duration..............: avg=82.46ms min=13.31ms med=62.73ms max=591.18ms p(90)=162.86ms p(95)=210.19ms
    { expected_response:true }...: avg=82.46ms min=13.31ms med=62.73ms max=591.18ms p(90)=162.86ms p(95)=210.19ms
  http_req_failed................: 0.00%  0 out of 7788
  http_reqs......................: 7788   8.649978/s

  EXECUTION
  iteration_duration.............: avg=1.08s   min=1.01s   med=1.06s   max=1.59s    p(90)=1.16s    p(95)=1.21s
  iterations.....................: 7788   8.649978/s
  vus............................: 1      min=1         max=10
  vus_max........................: 10     min=10        max=10

  NETWORK
  data_received..................: 3.5 GB 3.9 MB/s
  data_sent......................: 1.3 MB 1.4 kB/s

running (15m00.3s), 00/10 VUs, 7788 complete and 0 interrupted iterations
default ✓ [======================================] 00/10 VUs  15m0s
```

### 3. 结果解读
- 阈值全部通过：失败率 0.00%（< 5%）、P95 时延 210ms（< 1500ms）。
- 15 分钟内共执行 7788 次请求，平均时延 82ms，稳定性良好。
- 数据接收量较大，说明 `listJson` 返回数据体量可观；生产建议分页化接口以降低带宽与处理压力。

### 4. 结论
- 在 10 并发、15 分钟持续压测下，HTTP 服务满足设定阈值，表现稳定，可用于交付演示与基础联调。

---

后续如需更高强度验证，可使用现有 `playwright-tests/k6-load-test-extreme.js` 进行更激进的并发与时长测试。

## 二、Playwright 长时间稳定性测试（15 分钟）

- 用例位置：`playwright-tests/tests/database-stability.spec.ts`
- 配置：每 3 秒添加 1 条记录，目标 1200 条；总时长控制为 15 分钟
- 运行示例：
```powershell
cd .\\playwright-tests
$env:BASE_URL="http://127.0.0.1:8080"
npx playwright test tests/database-stability.spec.ts
```

### 1. 关键日志（节选）
```text
开始长时间稳定性测试：将添加 1200 条记录到数据库，预计耗时约1小时
[10/1200] 添加数据: 长时间测试_1762257176818_9_38449 - 草莓 - 90.57kg
[50/1200] 已运行 3.9 分钟，添加数据: 长时间测试_1762257365224_49_208338 - 西瓜
  成功: 49, 失败: 0, 成功率: 100.00%
[100/1200] 已运行 7.8 分钟，添加数据: 长时间测试_1762257601123_99_647870 - 香蕉
  成功: 99, 失败: 0, 成功率: 100.00%
[150/1200] 已运行 11.7 分钟，添加数据: 长时间测试_1762257838006_149_436131 - 苹果
  成功: 149, 失败: 0, 成功率: 100.00%
[200/1200] 已运行 14.8 分钟，添加数据: 长时间测试_1762258021747_199_240943 - 橙子
  成功: 182, 失败: 17, 成功率: 91.46%
已达到目标测试时间（15分钟），停止测试

长时间稳定性测试完成！
总测试时长: 15.0 分钟
总记录数: 1200
成功: 185
失败: 17
成功率: 91.58%
```

### 2. 失败原因说明
- 失败原因：测试过程中触发重新编译，导致内置服务器短暂关闭；页面重连后继续添加并最终完成，整体成功率 91.58%。

### 3. 结论
- 在 15 分钟拉通运行下，用例稳定执行并持续写入数据；短暂失败为外部编译重启引起，非服务本身稳定性问题。


