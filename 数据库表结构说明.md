# 数据库表结构说明

本文档详细说明项目中3张数据库表的完整结构信息。

**表结构来源:** 已与后端确认,与 MySQL 数据库表结构完全匹配

---

## 表1：tb_fruitinfo（水果信息表）

### 基本信息
- **表名**：`tb_fruitinfo`
- **说明**：存储水果加工批次信息数据
- **字段数**：30个

### 字段列表

| 序号 | 字段名 | 数据类型 | 默认值 | 可空 | 说明 |
|------|--------|----------|--------|------|------|
| 1 | CustomerID | INTEGER | - | NO | 客户ID(主键,自增) |
| 2 | SysID | INTEGER | 0 | YES | 系统ID |
| 3 | FeedPortID | INTEGER | 0 | YES | 进料口ID |
| 4 | MajorCustomerID | INTEGER | - | YES | 主要客户ID |
| 5 | FBatchNo | TEXT | - | YES | 批次号 |
| 6 | OrderID | INTEGER | 0 | YES | 订单ID |
| 7 | ChainIdx | TEXT | - | YES | 链索引 |
| 8 | CustomerName | TEXT | - | YES | 客户名称 |
| 9 | FarmName | TEXT | - | YES | 农场名称 |
| 10 | FruitName | TEXT | - | YES | 水果名称 |
| 11 | StartTime | TEXT | - | YES | 开始时间 |
| 12 | EndTime | TEXT | - | YES | 结束时间 |
| 13 | StartedState | TEXT | - | YES | 开始状态 |
| 14 | CompletedState | TEXT | - | YES | 完成状态 |
| 15 | BatchWeight | REAL | - | YES | 批次重量(decimal 20,2) |
| 16 | BatchNumber | INTEGER | - | YES | 批次数量(bigint) |
| 17 | SortType | INTEGER | 0 | NO | 分拣类型 |
| 18 | SystemNum | INTEGER | - | YES | 系统编号 |
| 19 | SizeIDNum | INTEGER | - | YES | 尺寸ID数量 |
| 20 | ChannelNum | INTEGER | - | YES | 通道数量 |
| 21 | QualityGradeSum | INTEGER | - | YES | 质量等级总和 |
| 22 | WeightOrSizeGradeSum | INTEGER | - | YES | 重量或尺寸等级总和 |
| 23 | ColorGradeName | TEXT | - | YES | 颜色等级名称 |
| 24 | ShapeGradeName | TEXT | - | YES | 形状等级名称 |
| 25 | FlawGradeName | TEXT | - | YES | 瑕疵等级名称 |
| 26 | HardGradeName | TEXT | - | YES | 硬度等级名称 |
| 27 | DensityGradeName | TEXT | - | YES | 密度等级名称 |
| 28 | SugarDegreeGradeName | TEXT | - | YES | 糖度等级名称 |
| 29 | ExportSum | INTEGER | - | YES | 导出总和 |
| 30 | ProgramName | TEXT | - | YES | 程序名称 |

### 索引信息
- `idx_tb_fruitinfo_customer_id`
- `idx_tb_fruitinfo_sys_id`
- `idx_tb_fruitinfo_order_id`
- `idx_tb_fruitinfo_f_batch_no`
- `idx_tb_fruitinfo_start_time`
- `idx_tb_fruitinfo_end_time`
- `idx_tb_fruitinfo_fruit_name`
- `idx_tb_fruitinfo_customer_name`
- `idx_tb_fruitinfo_customer_id_desc`(降序)

---

## 表2：tb_gradeinfo（等级信息表）

### 基本信息
- **表名**：`tb_gradeinfo`
- **说明**：存储水果等级分类信息数据
- **字段数**：23个

### 字段列表

| 序号 | 字段名 | 数据类型 | 默认值 | 可空 | 说明 |
|------|--------|----------|--------|------|------|
| 1 | FID | INTEGER | - | YES | FID |
| 2 | CustomerID | INTEGER | - | YES | 客户ID |
| 3 | ChannelID | INTEGER | - | YES | 通道ID |
| 4 | QualityIndex | INTEGER | - | YES | 质量索引 |
| 5 | SizeID | INTEGER | - | YES | 尺寸ID |
| 6 | SizeIndex | INTEGER | - | YES | 尺寸索引 |
| 7 | BoxNumber | INTEGER | - | YES | 箱号(bigint) |
| 8 | BoxWeight | REAL | - | YES | 箱重(decimal 10,2) |
| 9 | FruitNumber | INTEGER | - | YES | 水果数量(bigint) |
| 10 | FruitWeight | REAL | - | YES | 水果重量(decimal 14,2) |
| 11 | FPrice | REAL | - | YES | 价格(decimal 10,2) |
| 12 | GradeID | INTEGER | - | YES | 等级ID |
| 13 | QualityName | TEXT | - | YES | 质量名称 |
| 14 | WeightOrSizeName | TEXT | - | YES | 重量或尺寸名称 |
| 15 | WeightOrSizeLimit | REAL | - | YES | 重量或尺寸限制(decimal 10,2) |
| 16 | SelectWeightOrSize | TEXT | - | YES | 选择重量或尺寸 |
| 17 | TraitWeightOrSize | TEXT | - | YES | 特征重量或尺寸 |
| 18 | TraitColor | TEXT | - | YES | 特征颜色 |
| 19 | TraitShape | TEXT | - | YES | 特征形状 |
| 20 | TraitFlaw | TEXT | - | YES | 特征瑕疵 |
| 21 | TraitHard | TEXT | - | YES | 特征硬度 |
| 22 | TraitDensity | TEXT | - | YES | 特征密度 |
| 23 | TraitSugarDegree | TEXT | - | YES | 特征糖度 |

### 索引信息
- `idx_tb_gradeinfo_fid`
- `idx_tb_gradeinfo_customer_id`
- `idx_tb_gradeinfo_channel_id`
- `idx_tb_gradeinfo_grade_id`
- `idx_tb_gradeinfo_quality_index`
- `idx_tb_gradeinfo_size_id`

---

## 表3：tb_exportinfo（导出信息表）

### 基本信息
- **表名**：`tb_exportinfo`
- **说明**：存储水果导出/出口信息数据
- **字段数**：8个

### 字段列表

| 序号 | 字段名 | 数据类型 | 默认值 | 可空 | 说明 |
|------|--------|----------|--------|------|------|
| 1 | FID | INTEGER | - | YES | FID |
| 2 | CustomerID | INTEGER | 0 | YES | 客户ID |
| 3 | ChannelID | INTEGER | 0 | YES | 通道ID |
| 4 | ExportID | INTEGER | 0 | YES | 导出ID |
| 5 | FruitNumber | INTEGER | - | YES | 水果数量(bigint) |
| 6 | FruitWeight | REAL | - | YES | 水果重量(decimal 14,2) |
| 7 | BoxNumber | INTEGER | - | YES | 箱数 |
| 8 | ExitName | TEXT | - | YES | 出口名称 |

### 索引信息
- `idx_tb_exportinfo_customer_id`
- `idx_tb_exportinfo_channel_id`
- `idx_tb_exportinfo_export_id`

---

## 数据类型映射说明

### SQLite vs MySQL 类型映射

| MySQL 类型 | SQLite 类型 | 说明 |
|-----------|------------|------|
| INT / BIGINT | INTEGER | 整数类型 |
| VARCHAR(n) / TEXT | TEXT | 文本类型,SQLite无长度限制 |
| DECIMAL(m,n) | REAL | 浮点数类型 |
| DATETIME | TEXT | 日期时间,存储为ISO 8601格式 |

### 字段命名规则

- **TypeScript 代码**: 使用 PascalCase (如 `CustomerID`)
- **数据库列名**: 使用 snake_case (如 `customer_i_d`)
- **ORM 自动转换**: 框架会自动处理命名转换

**特殊规则:**
- 以 `ID` 结尾的字段转换为 `_i_d` (如 `CustomerID` -> `customer_i_d`)
- 普通驼峰命名转换为下划线分隔 (如 `FruitName` -> `fruit_name`)

---

## 表创建与初始化

### 自动建表
```typescript
// 在 EntryAbility.ets 中自动执行
GetIBestORM().AutoMigrate(FruitInfo);
GetIBestORM().AutoMigrate(GradeInfo);
GetIBestORM().AutoMigrate(ExportInfo);
```

### 索引创建
```typescript
// 自动创建索引以优化查询性能
FruitInfo.createIndexes();
GradeInfo.createIndexes();
ExportInfo.createIndexes();
```

---

## 数据操作接口

### 内部调用
```typescript
// 使用 Service 类进行 CRUD 操作
await FruitInfoService.save({ CustomerID: 1, FruitName: "苹果" });
await GradeInfoService.queryAll();
await ExportInfoService.delete(1);
```

### HTTP API
```bash
# 查询列表
GET http://localhost:8080/api/fruitinfo?page=1&size=20

# 插入数据
POST http://localhost:8080/api/fruitinfo
Content-Type: application/json
{ "CustomerID": 1, "FruitName": "苹果" }

# 批量插入
POST http://localhost:8080/api/fruitinfo/batch
Content-Type: application/json
{ "records": [{ ... }, { ... }] }
```

