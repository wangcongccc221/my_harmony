# 数据库表结构说明

本文档详细说明项目中两张数据库表的完整结构信息。

---

## 表1：tb_fruitinfo（水果信息表）

### 基本信息
- **表名**：`tb_fruitinfo`
- **说明**：存储水果加工信息数据

### 字段列表

| 序号 | 字段名 | 数据类型 | 默认值 | 可空 | 字符集/排序规则 | 说明 |
|------|--------|----------|--------|------|----------------|------|
| 1 | CustomerID | INTEGER | - | YES | - | 客户ID |
| 2 | SysID | INTEGER | 0 | YES | - | 系统ID |
| 3 | FeedPortID | INTEGER | 0 | YES | - | 进料口ID |
| 4 | MajorCustomerID | INTEGER | - | YES | - | 主要客户ID |
| 5 | FBatchNo | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 批次号 |
| 6 | OrderID | INTEGER | 0 | YES | - | 订单ID |
| 7 | Chainldx | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 链索引 |
| 8 | CustomerName | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 客户名称 |
| 9 | FarmName | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 农场名称 |
| 10 | FruitName | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 水果名称 |
| 11 | StartTime | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 开始时间 |
| 12 | EndTime | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 结束时间 |
| 13 | StartedState | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 开始状态 |
| 14 | CompletedState | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 完成状态 |
| 15 | BatchWeight | REAL | - | YES | - | 批次重量（decimal(20,2)） |
| 16 | BatchNumber | INTEGER | - | YES | - | 批次数量（bigint） |
| 17 | SortType | INTEGER | 0 | **NO** | - | 分拣类型 |
| 18 | SystemNum | INTEGER | - | YES | - | 系统编号 |
| 19 | SizeIDNum | INTEGER | - | YES | - | 尺寸ID数量 |
| 20 | ChannelNum | INTEGER | - | YES | - | 通道数量 |
| 21 | QualityGradeSum | INTEGER | - | YES | - | 质量等级总和 |
| 22 | WeightOrSizeGradeSum | INTEGER | - | YES | - | 重量或尺寸等级总和 |
| 23 | ColorGradeName | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 颜色等级名称 |
| 24 | SharpeGradeName | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 形状等级名称 |
| 25 | FlawGradeName | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 瑕疵等级名称 |
| 26 | HardGradeName | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 硬度等级名称 |
| 27 | DensityGradeName | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 密度等级名称 |
| 28 | SugarDegreeGradeName | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 糖度等级名称 |
| 29 | ExportSum | INTEGER | - | YES | - | 导出总和 |
| 30 | ProgramName | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 程序名称 |

### 特殊说明
- **默认值字段**：SysID、FeedPortID、OrderID、SortType（默认值：0）
- **非空字段**：SortType（NOT NULL）
- **字符集字段**：所有 TEXT 类型字段均使用 `utf8mb3` 字符集和 `utf8mb3_general_ci` 排序规则
- **系统字段**：id（主键，自增）、created_at（创建时间）、updated_at（更新时间）

---

## 表2：tb_gradeinfo（等级信息表）

### 基本信息
- **表名**：`tb_gradeinfo`
- **说明**：存储水果等级信息数据

### 字段列表

| 序号 | 字段名 | 数据类型 | 默认值 | 可空 | 字符集/排序规则 | 说明 |
|------|--------|----------|--------|------|----------------|------|
| 1 | FID | INTEGER | - | YES | - | FID |
| 2 | CustomerID | INTEGER | - | YES | - | 客户ID |
| 3 | ChannellD | INTEGER | - | YES | - | 通道ID |
| 4 | QualityIndex | INTEGER | - | YES | - | 质量索引 |
| 5 | SizelD | INTEGER | - | YES | - | 尺寸ID |
| 6 | Sizelndex | INTEGER | - | YES | - | 尺寸索引 |
| 7 | BoxNumber | INTEGER | - | YES | - | 箱号（bigint） |
| 8 | BoxWeight | REAL | - | YES | - | 箱重（decimal(10,2)） |
| 9 | FruitNumber | INTEGER | - | YES | - | 水果数量（bigint） |
| 10 | FruitWeight | REAL | - | YES | - | 水果重量（decimal(14,2)） |
| 11 | FPrice | REAL | - | YES | - | 价格（decimal(10,2)） |
| 12 | GradelD | INTEGER | - | YES | - | 等级ID |
| 13 | QualityName | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 质量名称 |
| 14 | WeightOrSizeName | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 重量或尺寸名称 |
| 15 | WeightOrSizeLimit | REAL | - | YES | - | 重量或尺寸限制（decimal(10,2)） |
| 16 | SelectWeightOrSize | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 选择重量或尺寸 |
| 17 | TraitWeightOrSize | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 特征重量或尺寸 |
| 18 | TraitColor | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 特征颜色 |
| 19 | TraitShape | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 特征形状 |
| 20 | TraitFlaw | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 特征瑕疵 |
| 21 | TraitHard | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 特征硬度 |
| 22 | TraitDensity | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 特征密度 |
| 23 | TraitSugarDegree | TEXT | - | YES | utf8mb3 / utf8mb3_general_ci | 特征糖度 |

### 特殊说明
- **默认值字段**：无
- **非空字段**：无（所有字段均可为空）
- **字符集字段**：所有 TEXT 类型字段均使用 `utf8mb3` 字符集和 `utf8mb3_general_ci` 排序规则
- **系统字段**：id（主键，自增）、created_at（创建时间）、updated_at（更新时间）

---

## 数据类型映射说明

### SQLite 数据类型映射
- **INTEGER**：对应 MySQL 的 `int`、`bigint`
- **REAL**：对应 MySQL 的 `decimal`、`float`、`double`
- **TEXT**：对应 MySQL 的 `varchar`、`char`、`text`

### 原始 MySQL 类型说明
- **decimal(20,2)**：在 SQLite 中映射为 `REAL`（BatchWeight）
- **decimal(10,2)**：在 SQLite 中映射为 `REAL`（BoxWeight、FPrice、WeightOrSizeLimit）
- **decimal(14,2)**：在 SQLite 中映射为 `REAL`（FruitWeight）
- **bigint**：在 SQLite 中映射为 `INTEGER`（BatchNumber、BoxNumber、FruitNumber）
- **varchar(50)**、**varchar(100)**：在 SQLite 中映射为 `TEXT`

---

## 索引信息

### tb_fruitinfo 表索引
- `idx_tb_fruitinfo_CustomerID`
- `idx_tb_fruitinfo_SysID`
- `idx_tb_fruitinfo_OrderID`
- `idx_tb_fruitinfo_FBatchNo`
- `idx_tb_fruitinfo_StartTime`
- `idx_tb_fruitinfo_EndTime`
- `idx_tb_fruitinfo_FruitName`
- `idx_tb_fruitinfo_CustomerName`
- `idx_tb_fruitinfo_id_desc`（主键降序索引）

### tb_gradeinfo 表索引
- `idx_tb_gradeinfo_FID`
- `idx_tb_gradeinfo_CustomerID`
- `idx_tb_gradeinfo_ChannellD`
- `idx_tb_gradeinfo_GradelD`
- `idx_tb_gradeinfo_QualityIndex`
- `idx_tb_gradeinfo_SizelD`
- `idx_tb_gradeinfo_id_desc`（主键降序索引）

---

## 使用说明

### 表创建
表会在应用启动时自动创建（通过 `AutoMigrate` 方法）。

### 数据操作
- 使用 `DatabaseHelper` 进行 CRUD 操作
- 使用 `DatabaseQueueManager` 进行异步操作
- 使用 ORM 模型类进行类型安全操作

### 注意事项
1. 所有字段名使用驼峰命名（PascalCase）
2. 数据库字段名使用下划线命名（snake_case）
3. ORM 会自动进行字段名转换
4. 字符集和排序规则仅对 TEXT 类型字段生效

---

## 更新记录

- **2025-12-02**：创建表结构文档
- 表结构基于项目实际代码生成

