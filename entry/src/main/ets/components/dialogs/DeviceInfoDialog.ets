/**
 * è®¾å¤‡ä¿¡æ¯å¯¹è¯æ¡†ç»„ä»¶
 * åŠŸèƒ½ï¼šæ˜¾ç¤ºå’Œç¼–è¾‘è®¾å¤‡ä¿¡æ¯
 */

import { OmniThemeManager, ExtendedOmniThemeStyle } from '../../utils/theme/OmniThemeManager'
import { getCurrentTheme } from '../../utils/theme/ThemeUtils'
import { OMNI_THEME_KEY, OMNI_THEME_VERSION_KEY } from '../../utils/theme/useOmniTheme'
import { t, I18N_VERSION_KEY } from '../../utils/i18n/I18nManager'

@Component
export struct DeviceInfoDialog {
  @Prop isVisible: boolean = false
  @StorageLink(OMNI_THEME_KEY) @Watch('onThemeChange') consumedTheme: ExtendedOmniThemeStyle = OmniThemeManager.getInstance().getCurrentTheme()
  @StorageLink(OMNI_THEME_VERSION_KEY) @Watch('onThemeChange') themeVersion: number = 0
  @StorageLink(I18N_VERSION_KEY) i18nVersion: number = 0

  // è®¾å¤‡ä¿¡æ¯çŠ¶æ€å˜é‡
  @State deviceNumber: string = 'RMFC20258013-1'
  @State deviceName: string = ''
  @State customerName: string = ''
  @State fruitVariety: string = ''
  @State exFactoryDate: string = '2021-05-11'
  @State expirationDate: string = '2021-05-11'
  @State personInCharge: string = ''
  @State contactPhone: string = ''
  @State location1: string = ''
  @State location2: string = ''
  @State location3: string = ''
  @State location4: string = ''
  @State detailedAddress: string = ''
  @State ipmVersion: string = ''
  @State rssVersion: string = ''
  @State scmVersion: string = ''
  @State fsmVersion: string = ''
  @State dwmVersion: string = ''
  @State wamVersion: string = ''
  @State iqmVersion: string = ''
  @State bdmVersion: string = ''
  @State debugger: string = ''
  @State updater: string = ''
  @State remarks: string = ''

  // å¯¹è¯æ¡†å›žè°ƒ
  onConfirm?: () => void
  onCancel?: () => void

  // èŽ·å–å½“å‰ä¸»é¢˜é…ç½®
  getCurrentTheme(): ExtendedOmniThemeStyle {
    return getCurrentTheme(this.consumedTheme)
  }

  // ç›‘å¬ä¸»é¢˜å˜åŒ–
  onThemeChange(): void {
    console.log('DeviceInfoDialog: ä¸»é¢˜å·²å˜åŒ–ï¼Œé‡æ–°æ¸²æŸ“')
  }

  // ç¡®è®¤æŒ‰é’®ç‚¹å‡»
  private handleConfirm(): void {
    if (this.onConfirm) {
      this.onConfirm()
    }
  }

  // å–æ¶ˆ/å…³é—­æŒ‰é’®ç‚¹å‡»
  private handleCancel(): void {
    if (this.onCancel) {
      this.onCancel()
    }
  }


  build() {
    // å¯¹è¯æ¡†é®ç½©å±‚
    Stack() {
      if (!this.isVisible) {
        // ä¸å¯è§æ—¶è¿”å›žç©ºå†…å®¹
        Blank()
      } else {
      // èƒŒæ™¯é®ç½©
      Column()
        .width('100%')
        .height('100%')
        .backgroundColor('rgba(0, 0, 0, 0.5)')
        .onClick(() => {
          this.handleCancel()
        })

      // å¯¹è¯æ¡†å†…å®¹
      Column() {
        // æ ‡é¢˜æ 
        Row() {
          Text('è®¾å¤‡ä¿¡æ¯')
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor(this.getCurrentTheme().textColor)
            .layoutWeight(1)
            .textAlign(TextAlign.Center)

          Button() {
            Text('Ã—')
              .fontSize(24)
              .fontColor(this.getCurrentTheme().textColor)
          }
          .type(ButtonType.Normal)
          .backgroundColor('transparent')
          .width(32)
          .height(32)
          .onClick(() => {
            this.handleCancel()
          })
        }
        .width('100%')
        .height(50)
        .padding({ left: 20, right: 12, top: 12, bottom: 12 })
        .border({ width: { bottom: 1 }, color: this.getCurrentTheme().borderColor })

        // å†…å®¹åŒºåŸŸ
        Scroll() {
          Row({ space: 20 }) {
            // å·¦åˆ—
            Column({ space: 0 }) {
              // è®¾å¤‡ç¼–å·
              Row() {
                Text('è®¾å¤‡ç¼–å·:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.deviceNumber })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.deviceNumber = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // å®¢æˆ·åç§°
              Row() {
                Text('å®¢æˆ·åç§°:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.customerName })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.customerName = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // å‡ºåŽ‚æ—¥æœŸ
              Row() {
                Text('å‡ºåŽ‚æ—¥æœŸ:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                Row() {
                  TextInput({ text: this.exFactoryDate })
                    .layoutWeight(1)
                    .height(32)
                    .backgroundColor('#FFFFFF')
                    .border({ width: 1, color: '#CCCCCC' })
                    .borderRadius(4)
                    .fontSize(13)
                    .onChange((value: string) => {
                      this.exFactoryDate = value
                    })

                  Button() {
                    Text('ðŸ“…')
                      .fontSize(16)
                  }
                  .type(ButtonType.Normal)
                  .backgroundColor('transparent')
                  .width(32)
                  .height(32)
                  .margin({ left: 4 })
                  .onClick(() => {
                    // TODO: æ‰“å¼€æ—¥æœŸé€‰æ‹©å™¨
                  })
                }
                .layoutWeight(1)
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // è´Ÿè´£äºº
              Row() {
                Text('è´Ÿè´£äºº:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.personInCharge })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.personInCharge = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // æ‰€åœ¨åœ°
              Row() {
                Text('æ‰€åœ¨åœ°:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                Column({ space: 8 }) {
                  Row({ space: 8 }) {
                    Select([{ value: this.location1 || 'è¯·é€‰æ‹©' }])
                      .selected(0)
                      .value(this.location1 || 'è¯·é€‰æ‹©')
                      .layoutWeight(1)
                      .height(32)
                      .onSelect((index: number) => {
                        // TODO: å®žçŽ°é€‰æ‹©é€»è¾‘
                      })

                    Select([{ value: this.location2 || 'è¯·é€‰æ‹©' }])
                      .selected(0)
                      .value(this.location2 || 'è¯·é€‰æ‹©')
                      .layoutWeight(1)
                      .height(32)
                      .onSelect((index: number) => {
                        // TODO: å®žçŽ°é€‰æ‹©é€»è¾‘
                      })
                  }

                  Row({ space: 8 }) {
                    Select([{ value: this.location3 || 'è¯·é€‰æ‹©' }])
                      .selected(0)
                      .value(this.location3 || 'è¯·é€‰æ‹©')
                      .layoutWeight(1)
                      .height(32)
                      .onSelect((index: number) => {
                        // TODO: å®žçŽ°é€‰æ‹©é€»è¾‘
                      })

                    Select([{ value: this.location4 || 'è¯·é€‰æ‹©' }])
                      .selected(0)
                      .value(this.location4 || 'è¯·é€‰æ‹©')
                      .layoutWeight(1)
                      .height(32)
                      .onSelect((index: number) => {
                        // TODO: å®žçŽ°é€‰æ‹©é€»è¾‘
                      })
                  }
                }
                .layoutWeight(1)
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // IPMç‰ˆæœ¬
              Row() {
                Text('IPMç‰ˆæœ¬:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.ipmVersion })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.ipmVersion = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // SCMç‰ˆæœ¬
              Row() {
                Text('SCMç‰ˆæœ¬:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.scmVersion })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.scmVersion = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // DWMç‰ˆæœ¬
              Row() {
                Text('DWMç‰ˆæœ¬:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.dwmVersion })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.dwmVersion = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // IQMç‰ˆæœ¬
              Row() {
                Text('IQMç‰ˆæœ¬:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.iqmVersion })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.iqmVersion = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // è°ƒè¯•äºº
              Row() {
                Text('è°ƒè¯•äºº:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.debugger })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.debugger = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // å¤‡æ³¨
              Row() {
                Text('å¤‡æ³¨:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.remarks })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.remarks = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)
            }
            .layoutWeight(1)

            // å³åˆ—
            Column({ space: 0 }) {
              // è®¾å¤‡åç§°
              Row() {
                Text('è®¾å¤‡åç§°:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.deviceName })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.deviceName = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // åŠ å·¥æ°´æžœå“ç§
              Row() {
                Text('åŠ å·¥æ°´æžœå“ç§:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.fruitVariety })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.fruitVariety = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // åˆ°æœŸæ—¥æœŸ
              Row() {
                Text('åˆ°æœŸæ—¥æœŸ:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                Row() {
                  TextInput({ text: this.expirationDate })
                    .layoutWeight(1)
                    .height(32)
                    .backgroundColor('#FFFFFF')
                    .border({ width: 1, color: '#CCCCCC' })
                    .borderRadius(4)
                    .fontSize(13)
                    .onChange((value: string) => {
                      this.expirationDate = value
                    })

                  Button() {
                    Text('ðŸ“…')
                      .fontSize(16)
                  }
                  .type(ButtonType.Normal)
                  .backgroundColor('transparent')
                  .width(32)
                  .height(32)
                  .margin({ left: 4 })
                  .onClick(() => {
                    // TODO: æ‰“å¼€æ—¥æœŸé€‰æ‹©å™¨
                  })
                }
                .layoutWeight(1)
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // è”ç³»ç”µè¯
              Row() {
                Text('è”ç³»ç”µè¯:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.contactPhone })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.contactPhone = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // è¯¦ç»†åœ°å€
              Row() {
                Text('è¯¦ç»†åœ°å€:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.detailedAddress })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.detailedAddress = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // RSSç‰ˆæœ¬
              Row() {
                Text('RSSç‰ˆæœ¬:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.rssVersion })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.rssVersion = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // FSMç‰ˆæœ¬
              Row() {
                Text('FSMç‰ˆæœ¬:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.fsmVersion })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.fsmVersion = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // WAMç‰ˆæœ¬
              Row() {
                Text('WAMç‰ˆæœ¬:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.wamVersion })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.wamVersion = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // BDMç‰ˆæœ¬
              Row() {
                Text('BDMç‰ˆæœ¬:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.bdmVersion })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.bdmVersion = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)

              // æ›´æ–°äºº
              Row() {
                Text('æ›´æ–°äºº:')
                  .fontSize(13)
                  .fontColor(this.getCurrentTheme().textColor)
                  .width(80)
                  .textAlign(TextAlign.End)
                  .margin({ right: 8 })

                TextInput({ text: this.updater })
                  .layoutWeight(1)
                  .height(32)
                  .backgroundColor('#FFFFFF')
                  .border({ width: 1, color: '#CCCCCC' })
                  .borderRadius(4)
                  .fontSize(13)
                  .onChange((value: string) => {
                    this.updater = value
                  })
              }
              .width('100%')
              .margin({ bottom: 12 })
              .alignItems(VerticalAlign.Center)
            }
            .layoutWeight(1)
          }
          .width('100%')
          .padding(20)
        }
        .layoutWeight(1)
        .width('100%')

        // åº•éƒ¨æŒ‰é’®åŒºåŸŸ
        Row({ space: 12 }) {
          Button('ç¡®å®š')
            .type(ButtonType.Normal)
            .fontSize(14)
            .fontColor('#FFFFFF')
            .backgroundColor('#4CAF50') // ç»¿è‰²èƒŒæ™¯
            .borderRadius(4)
            .width(100)
            .height(36)
            .onClick(() => {
              this.handleConfirm()
            })

          Button('å–æ¶ˆ')
            .type(ButtonType.Normal)
            .fontSize(14)
            .fontColor(this.getCurrentTheme().textColor)
            .backgroundColor('#E0E0E0') // æµ…ç°è‰²èƒŒæ™¯
            .borderRadius(4)
            .width(100)
            .height(36)
            .onClick(() => {
              this.handleCancel()
            })
        }
        .width('100%')
        .justifyContent(FlexAlign.Center)
        .padding({ left: 20, right: 20, top: 12, bottom: 20 })
        .border({ width: { top: 1 }, color: this.getCurrentTheme().borderColor })
      }
      .width('85%')
      .height('85%')
      .backgroundColor(this.getCurrentTheme().surfaceColor)
      .borderRadius(12)
      .shadow({ radius: 20, color: 'rgba(0, 0, 0, 0.3)', offsetY: 4 })
      .alignSelf(ItemAlign.Center)
      .constraintSize({ maxWidth: 1000, maxHeight: 800 })
      }
    }
    .width('100%')
    .height('100%')
    .alignContent(Alignment.Center)
  }
}

