/**
 * æ›´å¤šé¡µé¢å†…å®¹ç»„ä»¶
 * åŠŸèƒ½ï¼šæ˜¾ç¤ºç³»ç»Ÿè®¾ç½®ã€ä¸»é¢˜åˆ‡æ¢ã€æ•°æ®ç®¡ç†ç­‰åŠŸèƒ½
 * ç”¨é€”ï¼šåœ¨Homeé¡µé¢ä¸­ä½œä¸ºæ›´å¤šåŠŸèƒ½é¡µé¢æ˜¾ç¤º
 */

import { BaseComponentHelper } from '../../components/common/BaseComponent'
import { MoreTabBar } from './MoreTabBar'
import { OmniThemeManager, ExtendedOmniThemeStyle, OmniThemeType } from '../../utils/theme/OmniThemeManager'
import { OMNI_THEME_KEY, OMNI_THEME_TYPE_KEY, OMNI_THEME_VERSION_KEY } from '../../utils/theme/useOmniTheme'
import { useOmniTheme } from '../../utils/theme/useOmniTheme'
import { OmniUIUtils } from '../../utils/helpers/OmniUIUtils'
import { EngineeringSettingsDialog } from '../../components/dialogs/EngineeringSettingsDialog'

// è®¾ç½®é¡¹æ¥å£
interface SettingItem {
  icon: string
  title: string
  subtitle: string
  onClick?: () => void
}

@Component
export struct MoreContent {
  @StorageLink(OMNI_THEME_KEY) consumedTheme: ExtendedOmniThemeStyle = OmniThemeManager.getInstance().getCurrentTheme()
  @StorageLink(OMNI_THEME_TYPE_KEY) consumedThemeType: OmniThemeType = OmniThemeManager.getInstance().getCurrentThemeType()
  @StorageLink(OMNI_THEME_VERSION_KEY) themeVersion: number = 0
  private baseComponentHelper = new BaseComponentHelper()
  private omniThemeManager = OmniThemeManager.getInstance()
  private omniUIUtils = OmniUIUtils.getInstance()
  @State showThemeSelector: boolean = false
  @State selectedTheme: OmniThemeType = OmniThemeType.BLUE
  @State showEngineeringSettingsDialog: boolean = false

  // è®¾ç½®é¡¹é…ç½®
  private settingItems: SettingItem[] = [
    { icon: 'âš™ï¸', title: 'å·¥ç¨‹è®¾ç½®', subtitle: 'å·¥ç¨‹å‚æ•°é…ç½®', onClick: () => this.showEngineeringSettings() },
    { icon: 'ğŸ“±', title: 'è®¾å¤‡ä¿¡æ¯', subtitle: 'æŸ¥çœ‹è®¾å¤‡è¯¦ç»†ä¿¡æ¯' },
    { icon: 'ğŸ—‘ï¸', title: 'æ•°æ®æ¸…é›¶', subtitle: 'æ¸…ç©ºæ‰€æœ‰æ•°æ®' },
    { icon: 'ğŸ”§', title: 'é…ç½®è®¾ç½®', subtitle: 'ç³»ç»Ÿé…ç½®ç®¡ç†' },
    { icon: 'ğŸ‘¤', title: 'ç”¨æˆ·è®¾ç½®', subtitle: 'ç”¨æˆ·è´¦æˆ·ç®¡ç†' },
    { icon: 'â¬‡ï¸', title: 'ä¸‹è½½é…ç½®', subtitle: 'ä¸‹è½½é…ç½®æ–‡ä»¶' },
    { icon: 'âš ï¸', title: 'æ•…éšœä¿¡æ¯', subtitle: 'æŸ¥çœ‹æ•…éšœè®°å½•' },
    { icon: 'ğŸ”Œ', title: 'ç”µå™¨æ•…éšœè®¾ç½®', subtitle: 'ç”µå™¨æ•…éšœé…ç½®' },
    { icon: 'ğŸ·ï¸', title: 'è´´æ ‡è®¾ç½®', subtitle: 'æ ‡ç­¾æ‰“å°è®¾ç½®' },
    { icon: 'ğŸ› ï¸', title: 'ç³»ç»Ÿæ•…éšœè®¾ç½®', subtitle: 'ç³»ç»Ÿæ•…éšœé…ç½®' },
    { icon: 'ğŸ”„', title: 'å¤ä½æ‰æœæ¯', subtitle: 'é‡ç½®æ‰æœæ¯çŠ¶æ€' }
  ]

  getCurrentTheme(): ExtendedOmniThemeStyle {
    return this.baseComponentHelper.getCurrentTheme(this.consumedTheme)
  }

  // ä¸»é¢˜åˆ‡æ¢å¤„ç†
  private handleThemeChange(theme: OmniThemeType): void {
    const hook = useOmniTheme()
    hook.setTheme(theme)
    const themeName = this.omniThemeManager.getThemeName(theme)
    this.omniUIUtils.showSuccess(`å·²åˆ‡æ¢åˆ°${themeName}`)
  }

  // å·¥ç¨‹è®¾ç½®å¯¹è¯æ¡†å¤„ç†
  private showEngineeringSettings(): void {
    this.showEngineeringSettingsDialog = true
  }

  private handleEngineeringSettingsConfirm(): void {
    this.omniUIUtils.showSuccess('å·¥ç¨‹è®¾ç½®å·²ä¿å­˜')
    this.showEngineeringSettingsDialog = false
  }

  private handleEngineeringSettingsCancel(): void {
    this.omniUIUtils.showInfo('å·²å–æ¶ˆå·¥ç¨‹è®¾ç½®')
    this.showEngineeringSettingsDialog = false
  }

  @State private selectedTab: string = 'å‡ºå£'

  build() {
    Stack() {
      Column() {
        // TabBar å¯¼èˆªï¼ˆå°è£…ä¸ºç»„ä»¶ï¼‰
        MoreTabBar({ selectedTab: this.selectedTab, onSwitch: (tab: string) => { this.selectedTab = tab } })

        // å†…å®¹åŒºåŸŸ
        Scroll() {
          Column() {
            if (this.selectedTab === 'å‡ºå£') {
              this.buildExportContent()
            } else if (this.selectedTab === 'è®¾ç½®') {
              this.buildSettingsContent()
            } else if (this.selectedTab === 'å¸®åŠ©') {
              this.buildHelpContent()
            }
          }
          .width('100%')
          .backgroundColor(this.getCurrentTheme().pageBg ?? this.getCurrentTheme().backgroundColor)
        }
        .width('100%')
        .layoutWeight(1)
        .scrollable(ScrollDirection.Vertical)
        .scrollBar(BarState.Auto)
        .scrollBarColor(this.getCurrentTheme().borderColor)
        .scrollBarWidth(6)
      }
      .width('100%')
      .height('100%')
      .backgroundColor(this.getCurrentTheme().pageBg ?? this.getCurrentTheme().backgroundColor)

      // ä¸»é¢˜é€‰æ‹©å™¨å¼¹çª— - ä½¿ç”¨Stackç¡®ä¿åœ¨æœ€ä¸Šå±‚
      if (this.showThemeSelector) {
        this.buildThemeSelectorDialog()
      }

      // å·¥ç¨‹è®¾ç½®å¯¹è¯æ¡†
      if (this.showEngineeringSettingsDialog) {
        EngineeringSettingsDialog({
          isVisible: this.showEngineeringSettingsDialog,
          onConfirm: () => {
            this.handleEngineeringSettingsConfirm()
          },
          onCancel: () => {
            this.handleEngineeringSettingsCancel()
          }
        })
      }
    }
    .width('100%')
    .height('100%')
  }

  // æ„å»ºTabæŒ‰é’®
  @Builder
  buildTabButton(title: string, tabKey: string): void {
    Button(title)
      .fontSize(28)  // å­—ä½“è°ƒå¤§åˆ°28pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
      .fontWeight(this.selectedTab === tabKey ? FontWeight.Bold : FontWeight.Normal)
      .fontColor(this.selectedTab === tabKey ? this.getCurrentTheme().primary : this.getCurrentTheme().textColor)
      .backgroundColor(this.selectedTab === tabKey ? this.getCurrentTheme().primary + '20' : Color.Transparent)
      .borderRadius(10)  // åœ†è§’è°ƒå¤§
      .padding({ left: 30, right: 30, top: 16, bottom: 16 })  // å†…è¾¹è·è°ƒå¾—æ›´å¤§
      .onClick(() => {
        this.selectedTab = tabKey
      })
  }

  // æ„å»ºå‡ºå£å†…å®¹
  @Builder
  buildExportContent(): void {
    Column() {
      Text('å‡ºå£ç®¡ç†')
        .fontSize(32)  // å­—ä½“è°ƒå¤§åˆ°32pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
        .fontWeight(FontWeight.Bold)
        .fontColor(this.getCurrentTheme().textColor)
        .margin({ left: 16, right: 16, bottom: 20 })
        .alignSelf(ItemAlign.Start)

      // å‡ºå£åŠŸèƒ½åˆ—è¡¨
      Column() {
        this.buildExportItem('ğŸ—‘ï¸', 'å‡ºå£æ¸…ç©º', 'æ¸…ç©ºæ‰€æœ‰å‡ºå£æ•°æ®')
        this.buildExportItem('âš¡', 'ç”µç£é˜€æµ‹è¯•', 'ç”µç£é˜€æµ‹è¯•æ§åˆ¶')
        this.buildExportItem('ğŸ”§', 'ç”µæœºä½¿èƒ½', 'ç”µæœºä½¿èƒ½æ§åˆ¶')
        this.buildExportItem('ğŸ”„', 'å¤ä½æœæ¯', 'å¤ä½æœæ¯çŠ¶æ€')
        this.buildExportItem('ğŸ§ª', 'æµ‹è¯•æœæ¯', 'æµ‹è¯•æœæ¯åŠŸèƒ½')
        this.buildExportItem('ğŸ“¦', 'çº¸ç®±è§„æ ¼', 'çº¸ç®±è§„æ ¼è®¾ç½®')
        this.buildExportItem('ğŸ“º', 'å‡ºå£å±æ˜¾ç¤º', 'å‡ºå£å±æ˜¾ç¤ºæ§åˆ¶')
        this.buildExportItem('âš™ï¸', 'å‡ºå£å±è®¾ç½®', 'å‡ºå£å±å‚æ•°è®¾ç½®')
      }
      .width('100%')
      .backgroundColor(this.getCurrentTheme().surfaceColor)
      .borderRadius(12)
      .margin({ left: 16, right: 16, bottom: 20 })
      .shadow({ radius: 4, color: 'rgba(0,0,0,0.1)', offsetY: 2 })
    }
    .width('100%')
    .alignItems(HorizontalAlign.Start)
  }

  // æ„å»ºè®¾ç½®å†…å®¹
  @Builder
  buildSettingsContent(): void {
    Column() {
      Text('ç³»ç»Ÿè®¾ç½®')
        .fontSize(32)  // å­—ä½“è°ƒå¤§åˆ°32pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
        .fontWeight(FontWeight.Bold)
        .fontColor(this.getCurrentTheme().textColor)
        .margin({ left: 16, right: 16, bottom: 20 })
        .alignSelf(ItemAlign.Start)

      // ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
      this.buildThemeSwitchButton()

      // è®¾ç½®é¡¹åˆ—è¡¨
      Column() {
        ForEach(this.settingItems, (item: SettingItem) => {
          this.buildSettingItem(item.icon, item.title, item.subtitle, item.onClick)
        })
      }
      .width('100%')
      .backgroundColor(this.getCurrentTheme().surfaceColor)
      .borderRadius(12)
      .margin({ left: 16, right: 16, bottom: 20 })
      .shadow({ radius: 4, color: 'rgba(0,0,0,0.1)', offsetY: 2 })
    }
    .width('100%')
    .alignItems(HorizontalAlign.Start)
  }

  // æ„å»ºå¸®åŠ©åŠŸèƒ½é¡¹
  @Builder
  buildHelpItem(icon: string, title: string, subtitle: string): void {
    Row() {
      // å›¾æ ‡
      Text(icon)
        .fontSize(36)  // å›¾æ ‡å­—ä½“è°ƒå¤§åˆ°36pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
        .margin({ right: 16 })

      // æ–‡å­—å†…å®¹
      Column() {
        Text(title)
          .fontSize(26)  // æ ‡é¢˜å­—ä½“è°ƒå¤§åˆ°26pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
          .fontWeight(FontWeight.Medium)
          .fontColor(this.getCurrentTheme().textColor)
          .alignSelf(ItemAlign.Start)

        Text(subtitle)
          .fontSize(22)  // å‰¯æ ‡é¢˜å­—ä½“è°ƒå¤§åˆ°22pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
          .fontColor(this.getCurrentTheme().subTextColor)
          .alignSelf(ItemAlign.Start)
          .margin({ top: 2 })
      }
      .alignItems(HorizontalAlign.Start)
      .layoutWeight(1)

      // å³ç®­å¤´
      Text('>')
        .fontSize(26)  // ç®­å¤´å­—ä½“è°ƒå¤§åˆ°26pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
        .fontColor(this.getCurrentTheme().subTextColor)
    }
    .width('100%')
    .padding({ left: 20, right: 20, top: 16, bottom: 16 })
    .onClick(() => {
      console.log('Help item clicked:', title)
      // è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„åŠŸèƒ½å¤„ç†é€»è¾‘
    })

    // åˆ†å‰²çº¿ï¼ˆæœ€åä¸€é¡¹ä¸æ˜¾ç¤ºï¼‰
    Divider()
      .color(this.getCurrentTheme().borderColor)
      .strokeWidth(0.5)
      .margin({ left: 20, right: 20 })
  }

  // æ„å»ºå‡ºå£åŠŸèƒ½é¡¹
  @Builder
  buildExportItem(icon: string, title: string, subtitle: string): void {
    Row() {
      // å›¾æ ‡
      Text(icon)
        .fontSize(36)  // å›¾æ ‡å­—ä½“è°ƒå¤§åˆ°36pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
        .margin({ right: 16 })

      // æ–‡å­—å†…å®¹
      Column() {
        Text(title)
          .fontSize(26)  // æ ‡é¢˜å­—ä½“è°ƒå¤§åˆ°26pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
          .fontWeight(FontWeight.Medium)
          .fontColor(this.getCurrentTheme().textColor)
          .alignSelf(ItemAlign.Start)

        Text(subtitle)
          .fontSize(22)  // å‰¯æ ‡é¢˜å­—ä½“è°ƒå¤§åˆ°22pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
          .fontColor(this.getCurrentTheme().subTextColor)
          .alignSelf(ItemAlign.Start)
          .margin({ top: 2 })
      }
      .alignItems(HorizontalAlign.Start)
      .layoutWeight(1)

      // å³ç®­å¤´
      Text('>')
        .fontSize(26)  // ç®­å¤´å­—ä½“è°ƒå¤§åˆ°26pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
        .fontColor(this.getCurrentTheme().subTextColor)
    }
    .width('100%')
    .padding({ left: 20, right: 20, top: 16, bottom: 16 })
    .onClick(() => {
      console.log('Export item clicked:', title)
      // è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„åŠŸèƒ½å¤„ç†é€»è¾‘
    })

    // åˆ†å‰²çº¿ï¼ˆæœ€åä¸€é¡¹ä¸æ˜¾ç¤ºï¼‰
    Divider()
      .color(this.getCurrentTheme().borderColor)
      .strokeWidth(0.5)
      .margin({ left: 20, right: 20 })
  }

  // æ„å»ºè®¾ç½®é¡¹
  @Builder
  buildSettingItem(icon: string, title: string, subtitle: string, onClick?: () => void): void {
    Row() {
      // å›¾æ ‡
      Text(icon)
        .fontSize(36)  // å›¾æ ‡å­—ä½“è°ƒå¤§åˆ°36pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
        .margin({ right: 16 })

      // æ–‡å­—å†…å®¹
      Column() {
        Text(title)
          .fontSize(26)  // æ ‡é¢˜å­—ä½“è°ƒå¤§åˆ°26pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
          .fontWeight(FontWeight.Medium)
          .fontColor(this.getCurrentTheme().textColor)
          .alignSelf(ItemAlign.Start)

        Text(subtitle)
          .fontSize(22)  // å‰¯æ ‡é¢˜å­—ä½“è°ƒå¤§åˆ°22pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
          .fontColor(this.getCurrentTheme().subTextColor)
          .alignSelf(ItemAlign.Start)
          .margin({ top: 2 })
      }
      .alignItems(HorizontalAlign.Start)
      .layoutWeight(1)

      // å³ç®­å¤´
      Text('>')
        .fontSize(26)  // ç®­å¤´å­—ä½“è°ƒå¤§åˆ°26pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
        .fontColor(this.getCurrentTheme().subTextColor)
    }
    .width('100%')
    .padding({ left: 20, right: 20, top: 16, bottom: 16 })
    .onClick(() => {
      console.log('Setting item clicked:', title)
      if (onClick) {
        onClick()
      }
    })

    // åˆ†å‰²çº¿ï¼ˆæœ€åä¸€é¡¹ä¸æ˜¾ç¤ºï¼‰
    Divider()
      .color(this.getCurrentTheme().borderColor)
      .strokeWidth(0.5)
      .margin({ left: 20, right: 20 })
  }

  // æ„å»ºä¸»é¢˜åˆ‡æ¢æŒ‰é’®
  @Builder
  buildThemeSwitchButton(): void {
    Column() {
      Text('ä¸»é¢˜è®¾ç½®')
        .fontSize(26)  // å­—ä½“è°ƒå¤§åˆ°26pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
        .fontWeight(FontWeight.Medium)
        .fontColor(this.getCurrentTheme().textColor)
        .alignSelf(ItemAlign.Start)
        .margin({ left: 20, bottom: 12, top: 20 })

      // ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
      Button() {
        Row() {
          Text('ğŸ¨')
            .fontSize(36)  // å›¾æ ‡å­—ä½“è°ƒå¤§åˆ°36pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
            .margin({ right: 12 })
          
          Column() {
            Text('åˆ‡æ¢ä¸»é¢˜')
              .fontSize(26)  // å­—ä½“è°ƒå¤§åˆ°26pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
              .fontWeight(FontWeight.Medium)
              .fontColor('#FFFFFF')
            Text('ç‚¹å‡»é€‰æ‹©ä¸»é¢˜é¢œè‰²')
              .fontSize(22)  // å­—ä½“è°ƒå¤§åˆ°22pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
              .fontColor('#FFFFFF')
              .opacity(0.8)
          }
          .alignItems(HorizontalAlign.Start)
          .layoutWeight(1)
        }
        .width('100%')
        .justifyContent(FlexAlign.Start)
      }
      .width('100%')
      .height(60)
      .backgroundColor(this.getCurrentTheme().primary)
      .borderRadius(12)
      .margin({ left: 16, right: 16, bottom: 8 })
      .onClick(() => {
        this.selectedTheme = this.consumedThemeType // åˆå§‹åŒ–é€‰ä¸­ä¸»é¢˜ä¸ºå½“å‰ä¸»é¢˜
        this.showThemeSelector = true
      })
    }
    .width('100%')
    .alignItems(HorizontalAlign.Start)
  }

  // æ„å»ºä¸»é¢˜é€‰æ‹©å™¨å¼¹çª—
  @Builder
  buildThemeSelectorDialog(): void {
    Stack() {
      // é®ç½©å±‚
      Column()
        .width('100%')
        .height('100%')
        .backgroundColor('rgba(0, 0, 0, 0.5)')
        .onClick(() => {
          this.showThemeSelector = false
        })
      
      // å¼¹çª—å†…å®¹
      Column() {
        // æ ‡é¢˜æ 
        Row() {
          Text('é€‰æ‹©ä¸»é¢˜')
            .fontSize(30)  // å­—ä½“è°ƒå¤§åˆ°30pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
            .fontWeight(FontWeight.Bold)
            .fontColor(this.getCurrentTheme().textColor)
            .layoutWeight(1)
          
          // å…³é—­æŒ‰é’®
          Button() {
            Text('Ã—')
              .fontSize(30)  // å…³é—­æŒ‰é’®å­—ä½“è°ƒå¤§åˆ°30pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
              .fontColor(this.getCurrentTheme().textColor)
          }
          .width(30)
          .height(30)
          .backgroundColor(Color.Transparent)
          .onClick(() => {
            this.showThemeSelector = false
          })
        }
        .width('100%')
        .padding({ left: 20, right: 20, top: 15, bottom: 15 })
        .border({ width: { bottom: 1 }, color: this.getCurrentTheme().borderColor })
        
        // ä¸»é¢˜é€‰é¡¹ - å¯æ»šåŠ¨
        Scroll() {
          Column() {
            this.buildThemeOption('ğŸ”µ è“è‰²ä¸»é¢˜', OmniThemeType.BLUE)
            this.buildThemeOption('ğŸŸ¢ ç»¿è‰²ä¸»é¢˜', OmniThemeType.GREEN)
            this.buildThemeOption('ğŸŸ£ ç´«è‰²ä¸»é¢˜', OmniThemeType.PURPLE)
            this.buildThemeOption('ğŸŸ  æ©™è‰²ä¸»é¢˜', OmniThemeType.ORANGE)
            this.buildThemeOption('ğŸŒ¸ ç²‰è‰²ä¸»é¢˜', OmniThemeType.PINK)
            this.buildThemeOption('ğŸŒŠ é’è‰²ä¸»é¢˜', OmniThemeType.TEAL)
            this.buildThemeOption('ğŸ’™ å†·é™æ·±è“', OmniThemeType.DEEP_BLUE)
            this.buildThemeOption('ğŸ§¡ æš–è‰²è´¨æ„Ÿ', OmniThemeType.WARM_AMBER)
            this.buildThemeOption('âš« æç®€é»‘ç™½', OmniThemeType.MINIMAL)
            this.buildThemeOption('ğŸŒ¿ æ¸…æ–°ç»¿æ„', OmniThemeType.FRESH_GREEN)
            this.buildThemeOption('ğŸ’œ ä¼˜é›…ç´«è°ƒ', OmniThemeType.ELEGANT_PURPLE)
            this.buildThemeOption('ğŸ¯ ä¸“ä¸šè“è‰²', OmniThemeType.PROFESSIONAL_BLUE)
          }
          .width('100%')
          .padding(20)
        }
        .width('100%')
        .height(400)
        .scrollable(ScrollDirection.Vertical)
        .scrollBar(BarState.Auto)
        
        // åº•éƒ¨æŒ‰é’®
        Row() {
          Button('å–æ¶ˆ')
            .fontSize(26)  // å­—ä½“è°ƒå¤§åˆ°26pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
            .fontColor(this.getCurrentTheme().textColor)
            .backgroundColor(this.getCurrentTheme().backgroundColor)
            .border({ width: 1, color: this.getCurrentTheme().borderColor })
            .borderRadius(10)  // åœ†è§’è°ƒå¤§
            .padding({ left: 30, right: 30, top: 16, bottom: 16 })  // å†…è¾¹è·è°ƒå¾—æ›´å¤§
            .layoutWeight(1)
            .margin({ right: 10 })
            .onClick(() => {
              this.showThemeSelector = false
            })

          Button('ç¡®è®¤')
            .fontSize(26)  // å­—ä½“è°ƒå¤§åˆ°26pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
            .fontColor(Color.White)
            .backgroundColor(this.getCurrentTheme().primary)
            .borderRadius(10)  // åœ†è§’è°ƒå¤§
            .padding({ left: 30, right: 30, top: 16, bottom: 16 })  // å†…è¾¹è·è°ƒå¾—æ›´å¤§
            .layoutWeight(1)
            .margin({ left: 10 })
            .onClick(() => {
              this.handleThemeChange(this.selectedTheme)
              this.showThemeSelector = false
            })
        }
        .width('100%')
        .padding({ left: 20, right: 20, bottom: 20 })
      }
      .width('85%')
      .constraintSize({ maxWidth: 400, maxHeight: 600 })
      .backgroundColor(this.getCurrentTheme().surfaceColor)
      .borderRadius(12)
      .shadow({
        radius: 20,
        color: 'rgba(0, 0, 0, 0.1)',
        offsetX: 0,
        offsetY: 4
      })
      .alignSelf(ItemAlign.Center)
    }
    .width('100%')
    .height('100%')
    .alignContent(Alignment.Center)
  }
  
  // æ„å»ºä¸»é¢˜é€‰é¡¹
  @Builder
  buildThemeOption(text: string, theme: OmniThemeType): void {
    Row() {
      Text(text)
        .fontSize(26)  // ä¸»é¢˜é€‰é¡¹å­—ä½“è°ƒå¤§åˆ°26pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
        .fontColor(this.getCurrentTheme().textColor)
        .layoutWeight(1)
      
      // å½“å‰é€‰ä¸­ä¸»é¢˜æ ‡è¯†
      if (this.selectedTheme === theme) {
        Text('âœ“')
          .fontSize(26)  // é€‰ä¸­æ ‡è¯†å­—ä½“è°ƒå¤§åˆ°26pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
          .fontColor(this.getCurrentTheme().primary)
          .fontWeight(FontWeight.Bold)
      }
    }
    .width('100%')
    .padding({ top: 12, bottom: 12, left: 16, right: 16 })
    .backgroundColor(this.selectedTheme === theme ? this.getCurrentTheme().primary + '20' : Color.Transparent)
    .borderRadius(8)
    .margin({ bottom: 8 })
    .onClick(() => {
      this.selectedTheme = theme // åªæ›´æ–°é€‰ä¸­çŠ¶æ€ï¼Œä¸ç«‹å³åº”ç”¨ä¸»é¢˜
    })
  }

  // æ„å»ºå¸®åŠ©å†…å®¹
  @Builder
  buildHelpContent(): void {
    Column() {
      Text('å¸®åŠ©æ”¯æŒ')
        .fontSize(32)  // å­—ä½“è°ƒå¤§åˆ°32pxï¼Œæ›´æœ‰æ°”åŠ¿ï¼
        .fontWeight(FontWeight.Bold)
        .fontColor(this.getCurrentTheme().textColor)
        .margin({ left: 16, right: 16, bottom: 20 })
        .alignSelf(ItemAlign.Start)

      // å¸®åŠ©åŠŸèƒ½åˆ—è¡¨
      Column() {
        this.buildHelpItem('ğŸ“–', 'ç”¨æˆ·æ‰‹å†Œ', 'æŸ¥çœ‹ç³»ç»Ÿä½¿ç”¨è¯´æ˜')
        this.buildHelpItem('ğŸ”„', 'æ£€æŸ¥æ–°ç‰ˆæœ¬', 'æ£€æŸ¥ç³»ç»Ÿæ›´æ–°')
        this.buildHelpItem('ğŸ’¾', 'å¤‡ä»½è®¾ç½®', 'å¤‡ä»½å½“å‰ç³»ç»Ÿè®¾ç½®')
        this.buildHelpItem('ğŸ“¥', 'æ¢å¤è®¾ç½®', 'ä»å¤‡ä»½æ¢å¤è®¾ç½®')
        this.buildHelpItem('ğŸ”Œ', 'å…³é—­IPM', 'å…³é—­IPMæœåŠ¡')
        this.buildHelpItem('ğŸ“‹', 'åˆ†é€‰æ—¥å¿—', 'æŸ¥çœ‹åˆ†é€‰æ“ä½œæ—¥å¿—')
        this.buildHelpItem('â„¹ï¸', 'å…³äº', 'æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯')
        this.buildHelpItem('ğŸŒ', 'è¯­è¨€', 'åˆ‡æ¢ç³»ç»Ÿè¯­è¨€')
        this.buildHelpItem('ğŸšª', 'é€€å‡º', 'é€€å‡ºç³»ç»Ÿ')
        this.buildHelpItem('ğŸ‘¤', 'ç”¨æˆ·åˆ‡æ¢', 'åˆ‡æ¢ç”¨æˆ·è´¦æˆ·')
      }
      .width('100%')
      .backgroundColor(this.getCurrentTheme().surfaceColor)
      .borderRadius(12)
      .margin({ left: 16, right: 16, bottom: 20 })
      .shadow({ radius: 4, color: 'rgba(0,0,0,0.1)', offsetY: 2 })
    }
    .width('100%')
    .alignItems(HorizontalAlign.Start)
  }
}