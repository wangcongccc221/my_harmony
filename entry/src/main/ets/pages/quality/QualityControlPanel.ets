/**
 * å“è´¨é¡µé¢æŽ§åˆ¶é¢æ¿ç»„ä»¶
 * 
 * åŠŸèƒ½è¯´æ˜Žï¼š
 * - æä¾›å“è´¨é¡µé¢çš„æŽ§åˆ¶é¢æ¿åŠŸèƒ½
 * - åŒ…å«ç­‰çº§æ•°é‡é€‰æ‹©ã€è‡ªåŠ¨è®¾å®šã€è®¾ç½®å‚æ•°ç­‰æŽ§åˆ¶
 * - æ”¯æŒä¸»é¢˜åˆ‡æ¢å’Œæ ·å¼é€‚é…
 * 
 * ä¸»è¦ç‰¹æ€§ï¼š
 * - ç­‰çº§æ•°é‡é€‰æ‹©ï¼šæ”¯æŒ2-6ä¸ªç­‰çº§çš„é€‰æ‹©
 * - è‡ªåŠ¨è®¾å®šåŠŸèƒ½ï¼šä¸€é”®è‡ªåŠ¨è®¾å®šå‚æ•°
 * - è®¾ç½®å‚æ•°åŠŸèƒ½ï¼šæ‰“å¼€å‚æ•°è®¾ç½®é¢æ¿
 * - ä¸»é¢˜é€‚é…ï¼šæ”¯æŒæ˜Žæš—ä¸»é¢˜åˆ‡æ¢
 * - äº‹ä»¶å›žè°ƒï¼šæ”¯æŒå„ç§ç”¨æˆ·äº¤äº’äº‹ä»¶
 * 
 * ä½¿ç”¨åœºæ™¯ï¼š
 * - å“è´¨é¡µé¢é¡¶éƒ¨æŽ§åˆ¶åŒºåŸŸ
 * - ç”¨æˆ·é…ç½®å“è´¨å‚æ•°
 * - å¿«é€Ÿè®¾å®šå“è´¨ç­‰çº§
 * 
 * ç»„ä»¶ç»“æž„ï¼š
 * - ç­‰çº§æ•°é‡æ ‡ç­¾ï¼šæ˜¾ç¤º"ç­‰çº§æ•°é‡:"
 * - ç­‰çº§æ•°é‡é€‰æ‹©å™¨ï¼šä¸‹æ‹‰æ¡†é€‰æ‹©2-6ä¸ªç­‰çº§
 * - è‡ªåŠ¨è®¾å®šæŒ‰é’®ï¼šä¸€é”®è‡ªåŠ¨è®¾å®š
 * - è®¾ç½®å‚æ•°æŒ‰é’®ï¼šæ‰“å¼€å‚æ•°è®¾ç½®
 * 
 * äº‹ä»¶å¤„ç†ï¼š
 * - onLevelCountChangeï¼šç­‰çº§æ•°é‡å˜åŒ–äº‹ä»¶
 * - onAutoSetï¼šè‡ªåŠ¨è®¾å®šäº‹ä»¶
 * - onSettingsClickï¼šè®¾ç½®å‚æ•°äº‹ä»¶
 * 
 * æ ·å¼ç‰¹æ€§ï¼š
 * - å“åº”å¼è®¾è®¡ï¼šé€‚é…ä¸åŒå±å¹•å°ºå¯¸
 * - ä¸»é¢˜é€‚é…ï¼šæ”¯æŒæ˜Žæš—ä¸»é¢˜
 * - æŒ‰é’®æ ·å¼ï¼šç»Ÿä¸€çš„æŒ‰é’®è®¾è®¡
 * - å¸ƒå±€ä¼˜åŒ–ï¼šåˆç†çš„é—´è·å’Œå¯¹é½
 */

import { OmniThemeManager, OmniThemeType, ExtendedOmniThemeStyle } from '../../utils/theme/OmniThemeManager'
import { getCurrentTheme as resolveTheme } from '../../utils/theme/ThemeUtils'
import { OMNI_THEME_KEY, OMNI_THEME_TYPE_KEY, OMNI_THEME_VERSION_KEY } from '../../utils/theme/useOmniTheme'
import { LEVEL_COUNT_OPTIONS } from './QualityConstants'
import { GlobalLevelCountManager } from '../../utils/managers/GlobalLevelCountManager'

/**
 * å“è´¨é¡µé¢æŽ§åˆ¶é¢æ¿ç»„ä»¶
 * 
 * åŠŸèƒ½è¯´æ˜Žï¼š
 * - æä¾›å“è´¨é¡µé¢çš„æŽ§åˆ¶é¢æ¿åŠŸèƒ½
 * - åŒ…å«ç­‰çº§æ•°é‡é€‰æ‹©ã€è‡ªåŠ¨è®¾å®šã€è®¾ç½®å‚æ•°ç­‰æŽ§åˆ¶
 * - æ”¯æŒä¸»é¢˜åˆ‡æ¢å’Œæ ·å¼é€‚é…
 * 
 * å±žæ€§è¯´æ˜Žï¼š
 * - levelCountIndexï¼šå½“å‰é€‰ä¸­çš„ç­‰çº§æ•°é‡ç´¢å¼•
 * - onLevelCountChangeï¼šç­‰çº§æ•°é‡å˜åŒ–å›žè°ƒå‡½æ•°
 * - onAutoSetï¼šè‡ªåŠ¨è®¾å®šå›žè°ƒå‡½æ•°
 * - onSettingsClickï¼šè®¾ç½®å‚æ•°å›žè°ƒå‡½æ•°
 * 
 * ä¸»é¢˜æ”¯æŒï¼š
 * - æ”¯æŒæ˜Žæš—ä¸»é¢˜åˆ‡æ¢
 * - è‡ªåŠ¨é€‚é…ä¸»é¢˜é¢œè‰²
 * - å“åº”ä¸»é¢˜å˜åŒ–
 */
@Component
export struct QualityControlPanel {
  // ==================== å±žæ€§å®šä¹‰ ====================
  
  /**
   * å½“å‰é€‰ä¸­çš„ç­‰çº§æ•°é‡ç´¢å¼•
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - å­˜å‚¨å½“å‰é€‰ä¸­çš„ç­‰çº§æ•°é‡ç´¢å¼•
   * - ç”¨äºŽæŽ§åˆ¶é¢æ¿æ˜¾ç¤ºå’Œæ•°æ®å¤„ç†
   * - é»˜è®¤å€¼ä¸º0ï¼ˆå¯¹åº”2ä¸ªç­‰çº§ï¼‰
   * 
   * ä½¿ç”¨åœºæ™¯ï¼š
   * - æŽ§åˆ¶é¢æ¿æ˜¾ç¤ºå½“å‰é€‰æ‹©
   * - æ•°æ®å¤„ç†æ—¶ä½¿ç”¨é€‰ä¸­çš„ç­‰çº§æ•°é‡
   * - çŠ¶æ€é‡ç½®æ—¶æ¢å¤é»˜è®¤å€¼
   */
  @Prop levelCountIndex: number = 9
  
  /**
   * å½“å‰å®žé™…æ•°æ®æ¡æ•°
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - ç”¨äºŽæ»šè½®äº‹ä»¶å¤„ç†
   * - åŸºäºŽå®žé™…æ•°æ®æ¡æ•°è¿›è¡Œå¢žå‡
   */
  @Prop currentDataCount: number = 0

  /**
   * å½“å‰é€‰ä¸­çš„ç­‰çº§æ•°é‡ç´¢å¼•ï¼ˆå†…éƒ¨çŠ¶æ€ï¼‰
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - ç”¨äºŽå“åº”å…¨å±€ç®¡ç†å™¨çš„çŠ¶æ€å˜åŒ–
   * - æŽ§åˆ¶Selectç»„ä»¶çš„æ˜¾ç¤º
   * - ä¸ŽlevelCountIndexä¿æŒåŒæ­¥
   */
  @State @Watch('onCurrentSelectedIndexChange') private currentSelectedIndex: number = 0
  
  /**
   * å¼ºåˆ¶åˆ·æ–°æ ‡è¯†
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - ç”¨äºŽå¼ºåˆ¶Selectç»„ä»¶é‡æ–°æ¸²æŸ“
   * - è§£å†³Selectç»„ä»¶ä¸å“åº”@Stateå˜åŒ–çš„é—®é¢˜
   */
  @State private forceRefresh: number = 0

  // ==================== å…¨å±€ç®¡ç†å™¨ ====================
  
  /**
   * å…¨å±€ç­‰çº§æ•°é‡ç®¡ç†å™¨å®žä¾‹
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - ç®¡ç†å…¨å±€çš„ç­‰çº§æ•°é‡çŠ¶æ€
   * - æ”¯æŒæ»šè½®äº‹ä»¶ç›´æŽ¥ä¿®æ”¹ç­‰çº§æ•°é‡
   * - æä¾›çŠ¶æ€å˜åŒ–ç›‘å¬åŠŸèƒ½
   */
  private globalLevelCountManager = GlobalLevelCountManager.getInstance()

  // ==================== äº‹ä»¶å›žè°ƒ ====================
  
  /**
   * ç­‰çº§æ•°é‡å˜åŒ–å›žè°ƒå‡½æ•°
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - å¤„ç†ç”¨æˆ·é€‰æ‹©ç­‰çº§æ•°é‡çš„äº‹ä»¶
   * - æŽ¥æ”¶ç­‰çº§æ•°é‡ç´¢å¼•å‚æ•°
   * - å¯é€‰çš„å›žè°ƒå‡½æ•°
   * 
   * @param index ç­‰çº§æ•°é‡ç´¢å¼•
   * 
   * ä½¿ç”¨åœºæ™¯ï¼š
   * - ç”¨æˆ·ä»Žä¸‹æ‹‰æ¡†é€‰æ‹©ç­‰çº§æ•°é‡æ—¶
   * - ç¨‹åºè‡ªåŠ¨è®¾ç½®ç­‰çº§æ•°é‡æ—¶
   */
  onLevelCountChange?: (index: number) => void

  /**
   * è‡ªåŠ¨è®¾å®šå›žè°ƒå‡½æ•°
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - å¤„ç†ç”¨æˆ·ç‚¹å‡»è‡ªåŠ¨è®¾å®šæŒ‰é’®çš„äº‹ä»¶
   * - è‡ªåŠ¨è®¾å®šå“è´¨å‚æ•°
   * - å¯é€‰çš„å›žè°ƒå‡½æ•°
   * 
   * ä½¿ç”¨åœºæ™¯ï¼š
   * - ç”¨æˆ·ç‚¹å‡»è‡ªåŠ¨è®¾å®šæŒ‰é’®æ—¶
   * - ç¨‹åºéœ€è¦è‡ªåŠ¨è®¾å®šå‚æ•°æ—¶
   */
  onAutoSet?: () => void

  /**
   * è®¾ç½®å‚æ•°å›žè°ƒå‡½æ•°
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - å¤„ç†ç”¨æˆ·ç‚¹å‡»è®¾ç½®å‚æ•°æŒ‰é’®çš„äº‹ä»¶
   * - æ‰“å¼€å‚æ•°è®¾ç½®é¢æ¿
   * - å¯é€‰çš„å›žè°ƒå‡½æ•°
   * 
   * ä½¿ç”¨åœºæ™¯ï¼š
   * - ç”¨æˆ·ç‚¹å‡»è®¾ç½®å‚æ•°æŒ‰é’®æ—¶
   * - ç¨‹åºéœ€è¦æ‰“å¼€å‚æ•°è®¾ç½®æ—¶
   */
  onSettingsClick?: () => void

  // ==================== ä¸»é¢˜ç›¸å…³ ====================
  
  /**
   * å½“å‰ä¸»é¢˜æ ·å¼
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - å­˜å‚¨å½“å‰åº”ç”¨çš„ä¸»é¢˜æ ·å¼
   * - ç”¨äºŽç»„ä»¶æ ·å¼é€‚é…
   * - è‡ªåŠ¨å“åº”ä¸»é¢˜å˜åŒ–
   * 
   * ä½¿ç”¨åœºæ™¯ï¼š
   * - ç»„ä»¶æ¸²æŸ“æ—¶èŽ·å–ä¸»é¢˜æ ·å¼
   * - ä¸»é¢˜åˆ‡æ¢æ—¶è‡ªåŠ¨æ›´æ–°
   */
  @StorageLink(OMNI_THEME_KEY) consumedTheme: ExtendedOmniThemeStyle = OmniThemeManager.getInstance().getCurrentTheme()

  /**
   * å½“å‰ä¸»é¢˜ç±»åž‹
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - å­˜å‚¨å½“å‰åº”ç”¨çš„ä¸»é¢˜ç±»åž‹
   * - ç”¨äºŽä¸»é¢˜ç±»åž‹åˆ¤æ–­
   * - è‡ªåŠ¨å“åº”ä¸»é¢˜å˜åŒ–
   * 
   * ä½¿ç”¨åœºæ™¯ï¼š
   * - ä¸»é¢˜ç±»åž‹åˆ¤æ–­æ—¶
   * - ä¸»é¢˜åˆ‡æ¢æ—¶è‡ªåŠ¨æ›´æ–°
   */
  @StorageLink(OMNI_THEME_TYPE_KEY) consumedThemeType: OmniThemeType = OmniThemeManager.getInstance().getCurrentThemeType()

  /**
   * ä¸»é¢˜ç‰ˆæœ¬å·
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - å­˜å‚¨å½“å‰ä¸»é¢˜çš„ç‰ˆæœ¬å·
   * - ç”¨äºŽä¸»é¢˜æ›´æ–°æ£€æµ‹
   * - è‡ªåŠ¨å“åº”ä¸»é¢˜å˜åŒ–
   * 
   * ä½¿ç”¨åœºæ™¯ï¼š
   * - ä¸»é¢˜æ›´æ–°æ£€æµ‹æ—¶
   * - ä¸»é¢˜åˆ‡æ¢æ—¶è‡ªåŠ¨æ›´æ–°
   */
  @StorageLink(OMNI_THEME_VERSION_KEY) themeVersion: number = 0

  // ==================== æ–¹æ³•å®šä¹‰ ====================
  
  /**
   * èŽ·å–å½“å‰ä¸»é¢˜é…ç½®
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - èŽ·å–å½“å‰åº”ç”¨çš„ä¸»é¢˜é…ç½®
   * - è¿”å›žä¸»é¢˜æ ·å¼å¯¹è±¡
   * - ç”¨äºŽç»„ä»¶æ ·å¼é€‚é…
   * 
   * @returns å½“å‰ä¸»é¢˜æ ·å¼å¯¹è±¡
   * 
   * ä½¿ç”¨åœºæ™¯ï¼š
   * - ç»„ä»¶æ¸²æŸ“æ—¶èŽ·å–ä¸»é¢˜æ ·å¼
   * - æ ·å¼é€‚é…æ—¶è°ƒç”¨
   */
  getCurrentTheme(): ExtendedOmniThemeStyle {
    return resolveTheme(this.consumedTheme)
  }

  /**
   * ç»„ä»¶å³å°†å‡ºçŽ°æ—¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - åˆå§‹åŒ–å…¨å±€ç­‰çº§æ•°é‡ç®¡ç†å™¨
   * - è®¾ç½®çŠ¶æ€å˜åŒ–ç›‘å¬å™¨
   * - åŒæ­¥æœ¬åœ°çŠ¶æ€å’Œå…¨å±€çŠ¶æ€
   */
  aboutToAppear(): void {
    // åˆå§‹åŒ–å†…éƒ¨çŠ¶æ€
    this.currentSelectedIndex = this.levelCountIndex
    console.log(`ðŸŽ¯ QualityControlPanel aboutToAppear - åˆå§‹ç´¢å¼•: ${this.levelCountIndex}, å†…éƒ¨çŠ¶æ€: ${this.currentSelectedIndex}`)
    this.initializeGlobalLevelCountManager()
  }

  /**
   * ç›‘å¬currentSelectedIndexå˜åŒ–
   */
  onCurrentSelectedIndexChange(): void {
    console.log(`âœ… currentSelectedIndexå·²æ›´æ–°ä¸º: ${this.currentSelectedIndex}`)
    // å¼ºåˆ¶åˆ·æ–°Selectç»„ä»¶
    this.forceRefresh++
    console.log(`ðŸ”„ å¼ºåˆ¶åˆ·æ–°Selectç»„ä»¶ï¼Œåˆ·æ–°æ¬¡æ•°: ${this.forceRefresh}`)
    
    // å¼ºåˆ¶è§¦å‘UIæ›´æ–°
    this.forceRefresh = this.forceRefresh
  }

  /**
   * ä»Žå¤–éƒ¨æ›´æ–°ç­‰çº§æ•°é‡é€‰æ‹©å™¨
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - æ ¹æ®è¡¨æ ¼æ•°æ®æ¡æ•°æ›´æ–°ç­‰çº§æ•°é‡é€‰æ‹©å™¨
   * - å®žçŽ°åå‘æ•°æ®ç»‘å®š
   * - åŒæ­¥é€‰æ‹©å™¨æ˜¾ç¤º
   * 
   * @param dataCount è¡¨æ ¼æ•°æ®æ¡æ•°
   */
  public updateFromDataCount(dataCount: number): void {
    console.log(`ðŸŽ¯ å¤–éƒ¨æ›´æ–°ç­‰çº§æ•°é‡é€‰æ‹©å™¨: ${dataCount}æ¡æ•°æ®`)
    
    // æ›´æ–°å…¨å±€ç®¡ç†å™¨
    this.globalLevelCountManager.setCount(dataCount)
    
    console.log(`âœ… ç­‰çº§æ•°é‡é€‰æ‹©å™¨å·²ä»Žå¤–éƒ¨æ›´æ–°ä¸º: ${dataCount}ä¸ªç­‰çº§`)
  }

  // ä¿å­˜ç›‘å¬å™¨å›žè°ƒå¼•ç”¨ï¼Œç”¨äºŽæ¸…ç†
  private levelCountChangeCallback?: (newCount: number, newIndex: number) => void

  /**
   * åˆå§‹åŒ–å…¨å±€ç­‰çº§æ•°é‡ç®¡ç†å™¨
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - è®¾ç½®å…¨å±€ç®¡ç†å™¨çš„åˆå§‹çŠ¶æ€
   * - æ·»åŠ çŠ¶æ€å˜åŒ–ç›‘å¬å™¨
   * - åŒæ­¥æœ¬åœ°çŠ¶æ€å’Œå…¨å±€çŠ¶æ€
   */
  private initializeGlobalLevelCountManager(): void {
    // è®¾ç½®å…¨å±€ç®¡ç†å™¨çš„åˆå§‹ç´¢å¼•
    this.globalLevelCountManager.setIndex(this.levelCountIndex)
    
    // åˆ›å»ºç›‘å¬å™¨å›žè°ƒå¹¶ä¿å­˜å¼•ç”¨
    this.levelCountChangeCallback = (newCount: number, newIndex: number) => {
      console.log(`ðŸ”„ å…¨å±€ç­‰çº§æ•°é‡å˜åŒ–: ${newCount} (ç´¢å¼•: ${newIndex})`)
      
      // æ›´æ–°å†…éƒ¨çŠ¶æ€ï¼Œè§¦å‘UIæ›´æ–°
      this.currentSelectedIndex = newIndex
      console.log(`ðŸŽ¯ æ›´æ–°Selectç»„ä»¶æ˜¾ç¤ºç´¢å¼•: ${newIndex}`)
      
      // å¼ºåˆ¶åˆ·æ–°Selectç»„ä»¶
      this.forceRefresh++
      console.log(`ðŸ”„ å¼ºåˆ¶åˆ·æ–°Selectç»„ä»¶ï¼Œåˆ·æ–°æ¬¡æ•°: ${this.forceRefresh}`)
      
      // è§¦å‘æœ¬åœ°å›žè°ƒå‡½æ•°
      if (this.onLevelCountChange) {
        this.onLevelCountChange(newIndex)
      }
    }
    
    // æ·»åŠ çŠ¶æ€å˜åŒ–ç›‘å¬å™¨
    this.globalLevelCountManager.addChangeListener(this.levelCountChangeCallback)
    
    console.log(`ðŸŽ¯ å…¨å±€ç­‰çº§æ•°é‡ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆï¼Œå½“å‰ç´¢å¼•: ${this.levelCountIndex}`)
  }

  /**
   * ç»„ä»¶é”€æ¯æ—¶æ¸…ç†ç›‘å¬å™¨
   */
  aboutToDisappear(): void {
    // ç§»é™¤ç›‘å¬å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼å’Œç›‘å¬å™¨ç´¯ç§¯
    if (this.levelCountChangeCallback) {
      this.globalLevelCountManager.removeChangeListener(this.levelCountChangeCallback)
      this.levelCountChangeCallback = undefined
      console.log(`ðŸ—‘ï¸ QualityControlPanel: å·²ç§»é™¤ç­‰çº§æ•°é‡å˜åŒ–ç›‘å¬å™¨`)
    }
  }

  /**
   * æž„å»ºç»„ä»¶UI
   * 
   * åŠŸèƒ½è¯´æ˜Žï¼š
   * - æž„å»ºå“è´¨é¡µé¢æŽ§åˆ¶é¢æ¿çš„UIç»“æž„
   * - åŒ…å«ç­‰çº§æ•°é‡é€‰æ‹©ã€è‡ªåŠ¨è®¾å®šã€è®¾ç½®å‚æ•°ç­‰æŽ§åˆ¶
   * - æ”¯æŒä¸»é¢˜é€‚é…å’Œäº‹ä»¶å¤„ç†
   * 
   * ç»„ä»¶ç»“æž„ï¼š
   * - ç­‰çº§æ•°é‡æ ‡ç­¾ï¼šæ˜¾ç¤º"ç­‰çº§æ•°é‡:"
   * - ç­‰çº§æ•°é‡é€‰æ‹©å™¨ï¼šä¸‹æ‹‰æ¡†é€‰æ‹©2-6ä¸ªç­‰çº§
   * - è‡ªåŠ¨è®¾å®šæŒ‰é’®ï¼šä¸€é”®è‡ªåŠ¨è®¾å®š
   * - è®¾ç½®å‚æ•°æŒ‰é’®ï¼šæ‰“å¼€å‚æ•°è®¾ç½®
   * 
   * æ ·å¼ç‰¹æ€§ï¼š
   * - å“åº”å¼è®¾è®¡ï¼šé€‚é…ä¸åŒå±å¹•å°ºå¯¸
   * - ä¸»é¢˜é€‚é…ï¼šæ”¯æŒæ˜Žæš—ä¸»é¢˜
   * - æŒ‰é’®æ ·å¼ï¼šç»Ÿä¸€çš„æŒ‰é’®è®¾è®¡
   * - å¸ƒå±€ä¼˜åŒ–ï¼šåˆç†çš„é—´è·å’Œå¯¹é½
   * 
   * äº‹ä»¶å¤„ç†ï¼š
   * - ç­‰çº§æ•°é‡é€‰æ‹©ï¼šè§¦å‘onLevelCountChangeäº‹ä»¶
   * - è‡ªåŠ¨è®¾å®šæŒ‰é’®ï¼šè§¦å‘onAutoSetäº‹ä»¶
   * - è®¾ç½®å‚æ•°æŒ‰é’®ï¼šè§¦å‘onSettingsClickäº‹ä»¶
   */
  build() {
    Column() {
      Row() {
        // ç­‰çº§æ•°é‡æ ‡ç­¾
        Text('ç­‰çº§æ•°é‡:')
          .fontSize(24)
          .fontColor(this.getCurrentTheme().textColor)
          .margin({ right: 8 })

        // ç­‰çº§æ•°é‡é€‰æ‹©å™¨ - ä½¿ç”¨keyå¼ºåˆ¶é‡æ–°åˆ›å»º
        Select(LEVEL_COUNT_OPTIONS)
          .key(`select-${this.currentSelectedIndex}-${this.forceRefresh}`)
          .selected(this.currentSelectedIndex)
          .value(LEVEL_COUNT_OPTIONS[this.currentSelectedIndex]?.value || '0')
          .onAppear(() => {
            console.log(`ðŸŽ¯ Selectç»„ä»¶å‡ºçŽ° - å½“å‰é€‰ä¸­ç´¢å¼•: ${this.currentSelectedIndex}, å¼ºåˆ¶åˆ·æ–°: ${this.forceRefresh}`)
          })
          .font({ size: 22 })
          .fontColor(this.getCurrentTheme().textColor)
          .backgroundColor(this.getCurrentTheme().controlBg ?? this.getCurrentTheme().surfaceColor)
          .border({ width: 1, color: this.getCurrentTheme().borderColor })
          .borderRadius(6)
          .padding({ left: 8, right: 8, top: 4, bottom: 4 })
          .width('30%')
          .margin({ right: 8 })
          .onSelect((index: number) => {
            if (this.onLevelCountChange) {
              this.onLevelCountChange(index)
            }
          })
          .onAxisEvent((event?: AxisEvent) => {
            if (event) {
              const verticalValue = event.getVerticalAxisValue()
              const horizontalValue = event.getHorizontalAxisValue()
              
              console.log('ðŸŽ¡ æ»šè½®äº‹ä»¶è§¦å‘ - åž‚ç›´å€¼:', verticalValue, 'æ°´å¹³å€¼:', horizontalValue)
              
              // å¤„ç†åž‚ç›´æ»šè½®äº‹ä»¶
              console.log('ðŸ” æ£€æŸ¥æ»šè½®æ¡ä»¶ - åž‚ç›´å€¼ç»å¯¹å€¼:', Math.abs(verticalValue), 'æ°´å¹³å€¼ç»å¯¹å€¼:', Math.abs(horizontalValue))
              
              if (Math.abs(verticalValue) > Math.abs(horizontalValue)) {
                console.log('âœ… è¿›å…¥åž‚ç›´æ»šè½®å¤„ç†é€»è¾‘')
                console.log('ðŸŽ¯ ä½¿ç”¨å…¨å±€ç­‰çº§æ•°é‡ç®¡ç†å™¨å¤„ç†æ»šè½®äº‹ä»¶')
                
                // ä½¿ç”¨å…¨å±€ç®¡ç†å™¨å¤„ç†æ»šè½®äº‹ä»¶ï¼Œä¼ å…¥å®žé™…æ•°æ®æ¡æ•°
                this.globalLevelCountManager.handleWheelEvent(verticalValue, this.currentDataCount)
                
                console.log('âœ… å…¨å±€ç®¡ç†å™¨å¤„ç†å®Œæˆ')
              } else {
                console.log('âŒ ä¸æ»¡è¶³åž‚ç›´æ»šè½®æ¡ä»¶')
              }
            }
          })

        // è‡ªåŠ¨è®¾å®šæŒ‰é’®
        Button('è‡ªåŠ¨è®¾å®š')
          .fontSize(22)
          .backgroundColor(this.getCurrentTheme().primary)
          .fontColor('#FFFFFF')
          .borderRadius(8)
          .padding({ left: 12, right: 12 })
          .margin({ right: 6 })
          .onClick(() => {
            if (this.onAutoSet) {
              this.onAutoSet()
            }
          })

        // è®¾ç½®å‚æ•°æŒ‰é’®
        Button('è®¾ç½®å‚æ•°')
          .fontSize(22)
          .backgroundColor(this.getCurrentTheme().controlBg ?? this.getCurrentTheme().backgroundColor)
          .fontColor(this.getCurrentTheme().textColor)
          .border({ width: 1, color: this.getCurrentTheme().borderColor })
          .borderRadius(8)
          .padding({ left: 12, right: 12 })
          .onClick(() => {
            if (this.onSettingsClick) {
              this.onSettingsClick()
            }
          })
      }
      .width('100%')
    }
    .width('100%')
      .height('6%')
    .padding(16)
    .backgroundColor(this.getCurrentTheme().controlBg ?? this.getCurrentTheme().surfaceColor)
    .border({ width: 1, color: this.getCurrentTheme().borderColor })
    .borderRadius(12)
    .shadow({ radius: 8, color: 'rgba(0,0,0,0.15)', offsetY: 2 })
    .margin({ top: 12, bottom: 10, left: 16, right: 16 })
  }
}
