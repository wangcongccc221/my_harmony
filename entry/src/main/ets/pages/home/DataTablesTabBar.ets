/**
 * æ•°æ®è¡¨æ ¼TabBarç»„ä»¶
 * 
 * åŠŸèƒ½è¯´æ˜ï¼š
 * - æ›¿æ¢åŸæœ‰çš„FunctionButtonså’ŒDataTablesCard
 * - æä¾›6ä¸ªTabé¡µé¢çš„åˆ‡æ¢åŠŸèƒ½
 * - é›†æˆè¡¨æ ¼å†…å®¹æ˜¾ç¤º
 * - æ”¯æŒä¸»é¢˜é…ç½®å’Œæ ·å¼å®šåˆ¶
 * 
 * Tabé¡µé¢åˆ—è¡¨ï¼š
 * - ç­‰çº§è¡¨ï¼šæ˜¾ç¤ºç­‰çº§ç›¸å…³æ•°æ®
 * - ç­‰çº§ç»Ÿè®¡è¡¨ï¼šæ˜¾ç¤ºç»Ÿè®¡ç›¸å…³æ•°æ®
 * - åŠ å·¥æ›²çº¿ï¼šæ˜¾ç¤ºåŠ å·¥æ›²çº¿å›¾è¡¨
 * - åŠ å·¥æŸ±çŠ¶å›¾ï¼šæ˜¾ç¤ºåŠ å·¥æŸ±çŠ¶å›¾
 * - åŠ¨æ€è£…ç®±ï¼šæ˜¾ç¤ºè£…ç®±ç›¸å…³æ•°æ®
 * - æˆå“ï¼šæ˜¾ç¤ºæˆå“ç›¸å…³æ•°æ®
 * 
 * ç»„ä»¶ç‰¹ç‚¹ï¼š
 * - ç»Ÿä¸€TabBarè®¾è®¡ï¼šä¸é¡¹ç›®ä¸­å…¶ä»–TabBarä¿æŒä¸€è‡´
 * - é›†æˆå†…å®¹æ˜¾ç¤ºï¼šTabBarä¸‹æ–¹ç›´æ¥æ˜¾ç¤ºå¯¹åº”å†…å®¹
 * - ä¸»é¢˜æ”¯æŒï¼šä½¿ç”¨ä¸»é¢˜ç®¡ç†å™¨çš„æ ·å¼é…ç½®
 * - å“åº”å¼è®¾è®¡ï¼šæ”¯æŒä¸åŒå±å¹•å°ºå¯¸
 */

import { LevelTable, TableRow } from '../../components/layout/LevelTable'
import { GridTable } from '../../components/layout/GridTable'
import { DraggableGridTable, DragData } from '../../components/layout/DraggableGridTable'
import { BaseComponentHelper } from '../../components/common/BaseComponent'
import { OmniThemeManager, OmniThemeType, ExtendedOmniThemeStyle } from '../../utils/theme/OmniThemeManager'
import { OMNI_THEME_KEY, OMNI_THEME_TYPE_KEY, OMNI_THEME_VERSION_KEY } from '../../utils/theme/useOmniTheme'
import { drawLineChart, measureChartWidth, LineChartOptions } from '../../utils/lineChart'
import { ChartComponent, ChartComponentParams, ChartData } from '../../components/ChartComponent'
import { OmniTabBar, TabConfig, TabBarDirection } from '../../components/ui/OmniTabBar'

@Component
export struct DataTablesTabBar {
  private baseComponentHelper = new BaseComponentHelper()
  private lineCtx: CanvasRenderingContext2D = new CanvasRenderingContext2D()
  // æŠ˜çº¿å›¾å‚æ•°ä¸æ•°æ®
  private readonly lcChartHeight: number = 340
  private readonly lcCanvasPadding: number = 40
  private readonly lcXStep: number = 80
  @State lcData: number[] = []
  @State lcLabels: string[] = []
  private lcTimerId?: number
  private lcCurrentValue: number = 50
  private lcTimeIndex: number = 0
  private lcRealtimeEnabled: boolean = false
  
  // ä¸»é¢˜ç›¸å…³
  @StorageLink(OMNI_THEME_KEY) consumedTheme: ExtendedOmniThemeStyle = OmniThemeManager.getInstance().getCurrentTheme()
  @StorageLink(OMNI_THEME_TYPE_KEY) consumedThemeType: OmniThemeType = OmniThemeManager.getInstance().getCurrentThemeType()
  @StorageLink(OMNI_THEME_VERSION_KEY) themeVersion: number = 0
  
  // æä¾›ä¸»é¢˜ç»™å­ç»„ä»¶
  @Provide providedTheme: ExtendedOmniThemeStyle = this.consumedTheme

  // å½“å‰é€‰ä¸­çš„Tab
  @State selectedTab: string = 'ç­‰çº§è¡¨'

  // è¡¨æ ¼æ•°æ®
  @Prop levelTableData: TableRow[] = []
  @Prop containerTableData: TableRow[] = []
  @Prop statisticsTableData: TableRow[] = []
  @Prop dynamicPackingTableData: TableRow[] = []
  @Prop finishedProductsTableData: TableRow[] = []
  
  // åˆ·æ–°é”®ï¼Œç”¨äºå¼ºåˆ¶åˆ·æ–°è¡¨æ ¼
  @Prop refreshKey: number = 0

  // æ‹–æ‹½æ•°æ®
  @Prop levelTableDragData: DragData[] = []
  @Prop containerTableDragData: DragData[] = []
  @Prop statisticsTableDragData: DragData[] = []
  @Prop dynamicPackingTableDragData: DragData[] = []
  @Prop finishedProductsTableDragData: DragData[] = []

  // æ‹–æ‹½äº‹ä»¶å›è°ƒ
  onRowDragStart?: (dragData: DragData) => void
  onRowDragEnd?: () => void
  

  // è·å–å½“å‰ä¸»é¢˜é…ç½®
  private getCurrentTheme(): ExtendedOmniThemeStyle {
    return this.baseComponentHelper.getCurrentTheme(this.consumedTheme)
  }

  // å¤„ç†æ‹–æ‹½å¼€å§‹
  private handleDragStart(dragData: DragData) {
    console.log('DataTablesTabBar - æ‹–æ‹½å¼€å§‹:', dragData)
    if (this.onRowDragStart) {
      this.onRowDragStart(dragData)
    }
  }

  // å¤„ç†æ‹–æ‹½ç»“æŸ
  private handleDragEnd() {
    console.log('DataTablesTabBar - æ‹–æ‹½ç»“æŸ')
    if (this.onRowDragEnd) {
      this.onRowDragEnd()
    }
  }


  aboutToAppear() {
    // ç”ŸæˆæŠ˜çº¿å›¾æ¨¡æ‹Ÿæ•°æ®ï¼ˆ10ç‚¹ï¼Œ09:00å¼€å§‹ï¼Œæ¯åˆ†é’Ÿä¸€ä¸ªï¼‰
    const count = 10
    const startHour = 9
    const startMinute = 0
    const series: number[] = []
    let cur = 50
    for (let i = 0; i < count; i++) {
      const change = (Math.random() - 0.5) * 20
      cur = Math.max(10, Math.min(90, cur + change))
      series.push(Math.round(cur))
    }
    const lbs: string[] = []
    for (let i = 0; i < count; i++) {
      const h = startHour + Math.floor((startMinute + i) / 60)
      const m = (startMinute + i) % 60
      lbs.push(`${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`)
    }
    this.lcData = series
    this.lcLabels = lbs
    this.lcTimeIndex = count
    this.lcRealtimeEnabled = true

    // å¯åŠ¨æŒç»­è¿½åŠ æ•°æ®ï¼ˆæ¯ç§’1ä¸ªç‚¹ï¼‰- å¯ç”¨è‡ªåŠ¨æ·»åŠ æ•°æ®åŠŸèƒ½
    if (this.lcRealtimeEnabled && !this.lcTimerId) {
      this.lcTimerId = setInterval(() => {
        const totalMin = startMinute + this.lcTimeIndex
        const h = startHour + Math.floor(totalMin / 60)
        const m = totalMin % 60
        const hh = h.toString().padStart(2, '0')
        const mm = m.toString().padStart(2, '0')
        const newLabel = `${hh}:${mm}`

        // éšæœºæ¸¸èµ°
        const step = (Math.random() - 0.5) * 20
        this.lcCurrentValue = Math.max(10, Math.min(90, Math.round(this.lcCurrentValue + step)))

        this.lcLabels = [...this.lcLabels, newLabel]
        this.lcData = [...this.lcData, this.lcCurrentValue]
        this.lcTimeIndex++

        // è¶…è¿‡60ä¸ªæ•°æ®å°±è‡ªåŠ¨æ¸…ç©ºï¼Œé‡æ–°å¼€å§‹æ˜¾ç¤º
        const maxDataPoints = 60 
        if (this.lcData.length > maxDataPoints) {
          console.log(`ğŸ”„ æ•°æ®é‡è¶…è¿‡${maxDataPoints}ï¼Œè‡ªåŠ¨æ¸…ç©ºé‡æ–°å¼€å§‹...`)
          this.lcData = []
          this.lcLabels = []
          this.lcTimeIndex = 0
          console.log(`âœ… æ•°æ®å·²æ¸…ç©ºï¼Œé‡æ–°å¼€å§‹è¿½è¸ª`)
        }

        // æ§åˆ¶å°è¾“å‡ºå½“å‰æ•°æ®æ¡æ•°
        console.log(`ğŸ“Š ç¬¬${this.lcTimeIndex}æ¡æ•°æ® - æ—¶é—´: ${newLabel} - è¿›åº¦: ${this.lcCurrentValue}%`)

        // æ•°æ®æ›´æ–°åé‡ç»˜
        setTimeout(() => {
          const opts: LineChartOptions = {
            chartHeight: this.lcChartHeight,
            canvasPadding: this.lcCanvasPadding,
            xStep: this.lcXStep,
            data: this.lcData,
            labels: this.lcLabels,
            yMax: 100,
            axisFontSizePx: 18,
            labelFontSizePx: 18,
            axisFontBold: true,
            labelFontBold: true,
            lineWidthPx: 3,
            pointRadiusPx: 5
          }
          drawLineChart(this.lineCtx, opts)
        }, 0)
      }, 1000) as number
    }
  }

  aboutToDisappear() {
    if (this.lcTimerId) {
      clearInterval(this.lcTimerId)
      this.lcTimerId = undefined
    }
  }

  // Tabé…ç½®
  private tabConfig: TabConfig[] = [
    { key: 'ç­‰çº§è¡¨', label: 'ç­‰çº§è¡¨' },
    { key: 'ç­‰çº§ç»Ÿè®¡è¡¨', label: 'ç­‰çº§ç»Ÿè®¡è¡¨' },
    { key: 'åŠ å·¥æ›²çº¿', label: 'åŠ å·¥æ›²çº¿' },
    { key: 'åŠ å·¥æŸ±çŠ¶å›¾', label: 'åŠ å·¥æŸ±çŠ¶å›¾' },
    { key: 'åŠ¨æ€è£…ç®±', label: 'åŠ¨æ€è£…ç®±' },
    { key: 'æˆå“', label: 'æˆå“' }
  ]

  // å¤„ç†Tabåˆ‡æ¢
  private handleTabChange(tabKey: string) {
    this.selectedTab = tabKey
  }

  // æ„å»ºå†…å®¹åŒºåŸŸ
  @Builder
  private buildContent() {
    Column() {
      if (this.selectedTab === 'ç­‰çº§è¡¨') {
        // æ˜¾ç¤ºç­‰çº§è¡¨å’Œå®¹å™¨è¡¨ï¼ˆå·¦å³åˆ†å¸ƒï¼‰- ä½¿ç”¨æ–°çš„GridTableç»„ä»¶
        Row() {
          // å·¦ä¾§ï¼šç­‰çº§è¡¨å¡ç‰‡ï¼ˆæ”¯æŒæ‹–æ‹½ï¼‰
          GridTable({
            tableName: 'ç­‰çº§è¡¨',
            tableRows: this.levelTableData,
            tableTitle: 'ç­‰çº§è¡¨',
            headerTitles: ['ç­‰çº§', '30', '20', '10', '0'],
            tableWidth: '100%',
            maxHeight: '72%', // ç­‰çº§è¡¨æœ€å¤§é«˜åº¦æ”¹ä¸º65%
            enableDrag: true,
            headerHeight: 60,  // ç­‰çº§è¡¨è¡¨å¤´é«˜åº¦
            dataRowHeight: 75,  // ç­‰çº§è¡¨æ•°æ®è¡Œé«˜åº¦
            dividerHeight: 75,   // ç­‰çº§è¡¨åˆ†å‰²çº¿é«˜åº¦
            customBorderWidth: 2      // ç­‰çº§è¡¨è¾¹æ¡†å®½åº¦
          })
          .width('48%')

          // å³ä¾§ï¼šå®¹å™¨è¡¨å¡ç‰‡ï¼ˆæ”¯æŒæ‹–æ‹½ï¼‰
          GridTable({
            tableName: 'å®¹å™¨è¡¨',
            tableRows: this.containerTableData,
            tableTitle: 'å®¹å™¨è¡¨',
            headerTitles: ['å®¹å™¨åç§°', 'åˆ†é€‰æ ‡å‡†', 'å®¹å™¨è§„æ ¼', 'å®¹å™¨ç­‰çº§'],
            tableWidth: '100%',
            maxHeight: '72%',
            enableDrag: true,
            headerHeight: 62,  // å®¹å™¨è¡¨è¡¨å¤´é«˜åº¦
            dataRowHeight: 73,  // å®¹å™¨è¡¨æ•°æ®è¡Œé«˜åº¦
            dividerHeight: 73,   // å®¹å™¨è¡¨åˆ†å‰²çº¿é«˜åº¦
            customBorderWidth: 2      // å®¹å™¨è¡¨è¾¹æ¡†å®½åº¦
          })
          .width('48%')
          .margin({ left: '2%', right: '2px' })
        }
        .width('100%')
        .height('100%')
        .justifyContent(FlexAlign.Start)
        .alignItems(VerticalAlign.Top)
      } else if (this.selectedTab === 'ç­‰çº§ç»Ÿè®¡è¡¨') {
        GridTable({
          tableName: 'ç­‰çº§ç»Ÿè®¡è¡¨',
          tableRows: this.statisticsTableData,
          tableTitle: 'ç­‰çº§ç»Ÿè®¡è¡¨',
          headerTitles: ['ç­‰çº§', 'é‡é‡', 'å‡ºå£', 'ä¸ªæ•°', 'å æ¯”', 'é‡é‡2', 'å æ¯”2', 'ç®±æ•°', 'å æ¯”3', 'ç®±é‡', 'å¹³å‡'],
          tableWidth: '100%',
          maxHeight: '72%',
          enableDrag: false,    // æ‹–æ‹½è®¾ç½®
          enableScroll: false, // æ»šåŠ¨è®¾ç½®
            headerHeight: 60,  // ç­‰çº§ç»Ÿè®¡è¡¨è¡¨å¤´é«˜åº¦
            dataRowHeight: 75,  // ç­‰çº§ç»Ÿè®¡è¡¨æ•°æ®è¡Œé«˜åº¦
            dividerHeight: 75,   // ç­‰çº§ç»Ÿè®¡è¡¨åˆ†å‰²çº¿é«˜åº¦
          customBorderWidth: 2      // ç­‰çº§ç»Ÿè®¡è¡¨è¾¹æ¡†å®½åº¦
        })
        .key(`statistics_table_${this.refreshKey}`)
      } else if (this.selectedTab === 'åŠ å·¥æ›²çº¿') {
        // ä½¿ç”¨è‡ªå®šä¹‰ Canvas æŠ˜çº¿å›¾å·¥å…·ï¼ˆå¯æ¨ªå‘æ»šåŠ¨ï¼‰
        Scroll() {
          Canvas(this.lineCtx)
            .width(measureChartWidth({ canvasPadding: this.lcCanvasPadding, xStep: this.lcXStep, data: this.lcData }))
            .height(this.lcChartHeight)
            .onReady(() => {
              const opts: LineChartOptions = {
                chartHeight: this.lcChartHeight,
                canvasPadding: this.lcCanvasPadding,
                xStep: this.lcXStep,
                data: this.lcData,
                labels: this.lcLabels,
                yMax: 100,
                axisFontSizePx: 18,
                labelFontSizePx: 18,
                axisFontBold: true,
                labelFontBold: true,
                lineWidthPx: 3,
                pointRadiusPx: 5,
                colors: {
                  background: (this.getCurrentTheme().chartBg ?? this.getCurrentTheme().surfaceColor) as string,
                  axis: this.getCurrentTheme().borderColor as string,
                  grid: (this.getCurrentTheme().borderColor as string) + '40',
                  line: (this.getCurrentTheme().chartLineColor ?? this.getCurrentTheme().primary) as string,
                  pointFill: (this.getCurrentTheme().chartLineColor ?? this.getCurrentTheme().primary) as string,
                  pointStroke: this.getCurrentTheme().surfaceColor as string,
                  axisText: this.getCurrentTheme().textColor as string,
                  labelText: this.getCurrentTheme().textColor as string
                }
              }
              drawLineChart(this.lineCtx, opts)
            })
        }
        .scrollable(ScrollDirection.Horizontal)
        .scrollBar(BarState.Auto)
        .width('100%')
        .height(this.lcChartHeight)
        .border({ width: 1, color: this.getCurrentTheme().borderColor })
        .borderRadius(4)
        .backgroundColor(this.getCurrentTheme().chartBg ?? this.getCurrentTheme().surfaceColor)
      } else if (this.selectedTab === 'åŠ å·¥æŸ±çŠ¶å›¾') {
        ChartComponent({
          params: {
            dataCount: 10, // ä¸»é¡µåªæ˜¾ç¤º10æ¡æ•°æ®
            startHour: 9,
            startMinute: 0,
            chartHeight: 280, // é™ä½é«˜åº¦ï¼Œè®©xè½´æ ‡ç­¾å¯è§
            barWidth: 25, // ä¸»é¡µæŸ±å­å®½åº¦æ”¹ä¸º25px
            barSpacing: 40, // åŠ å·¥æŸ±çŠ¶å›¾ä½¿ç”¨è¾ƒç´§å¯†çš„é—´è·
            showScrollBar: false, // éšè—æ»šåŠ¨æ¡
            axisFontSizePx: 18,
            labelFontSizePx: 18,
            axisFontBold: true,
            labelFontBold: true,
            onDataClick: (data: ChartData, event: ClickEvent) => {
              console.log(`ç‚¹å‡»äº†åŠ å·¥æ•°æ®: ${data.time} - ${data.value}`);
            }
          }
        })
      } else if (this.selectedTab === 'åŠ¨æ€è£…ç®±') {
        // ä½¿ç”¨Gridç»„ä»¶æ˜¾ç¤ºåŠ¨æ€è£…ç®±è¡¨æ ¼ï¼ˆå¸¦å¡ç‰‡åŒ…è£¹ï¼‰
        Column() {
          Text('åŠ¨æ€è£…ç®±')
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor(this.getCurrentTheme().textColor)
            .alignSelf(ItemAlign.Start)
            .margin({ bottom: 4 })

          // è¡¨æ ¼å®¹å™¨ï¼ˆå¡ç‰‡æ ·å¼ï¼‰
          Column() {
            Grid() {
            // è¡¨å¤´
            ForEach(['å‡ºå£', 'æµæ°´ç ', 'è£…ç®±è§„æ ¼', 'ç­‰çº§', 'ç®±æ•°', 'çº¸ç®±è§„æ ¼', 'çº¸ç®±å‡€é‡', 'ç®±æ•°/åˆ†'], (title: string, index: number) => {
              GridItem() {
                Text(title)
                  .fontSize(20)
                  .fontWeight(FontWeight.Bold)
                  .fontColor(this.getCurrentTheme().tableHeaderTextColor ?? this.getCurrentTheme().textColor)
                  .textAlign(TextAlign.Center)
                  .width('100%')
                  .height(50)
                  .padding(6)
                  .backgroundColor(this.getCurrentTheme().tableHeaderBg ?? this.getCurrentTheme().controlBg ?? this.getCurrentTheme().surfaceColor)
                  .border({ width: { right: 1, bottom: 1 }, color: this.getCurrentTheme().borderColor })
              }
            })
            
            // æ•°æ®è¡Œ
            ForEach(this.dynamicPackingTableData, (row: string[], rowIndex: number) => {
              ForEach(row, (cell: string, colIndex: number) => {
                GridItem() {
                  Text(cell)
                    .fontSize(16)
                    .fontColor(this.getCurrentTheme().textColor)
                    .textAlign(TextAlign.Center)
                    .width('100%')
                    .height(65)
                    .padding(2)
                    .backgroundColor(this.getCurrentTheme().controlBg ?? this.getCurrentTheme().surfaceColor)
                    .border({ width: { right: 1, bottom: 1 }, color: this.getCurrentTheme().borderColor })
                }
              })
            })
          }
          .columnsTemplate('1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr')
          .columnsGap(0)
          .rowsGap(0)
          .width('100%')
          .height('75%')
          .backgroundColor(this.getCurrentTheme().surfaceColor)
          .borderRadius(8)
        }
        .width('100%')
        .alignItems(HorizontalAlign.Start)
      }
      .width('100%')
      .backgroundColor(this.getCurrentTheme().controlBg ?? this.getCurrentTheme().surfaceColor)
      .border({ width: 1, color: this.getCurrentTheme().borderColor })
      .borderRadius(6)
      .padding(4)
      .margin({ top: 4, left: 4, right: 4, bottom: 2 })
      .alignItems(HorizontalAlign.Center)
      .justifyContent(FlexAlign.Center)
      } else if (this.selectedTab === 'æˆå“') {
        // ä½¿ç”¨Gridç»„ä»¶æ˜¾ç¤ºæˆå“è¡¨æ ¼ï¼ˆå¸¦å¡ç‰‡åŒ…è£¹ï¼‰
        Column() {
          Text('æˆå“')
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor(this.getCurrentTheme().textColor)
            .alignSelf(ItemAlign.Start)
            .margin({ bottom: 4 })

          // è¡¨æ ¼å®¹å™¨ï¼ˆå¡ç‰‡æ ·å¼ï¼‰
          Column() {
            Grid() {
            // è¡¨å¤´
            ForEach(['æˆå“ç ', 'å‡ºå£', 'æµæ°´ç ', 'å®¹å™¨åç§°', 'ç­‰çº§', 'åŒ…è£…æ—¶é—´', 'çº¸ç®±è§„æ ¼', 'çº¸ç®±å‡€é‡'], (title: string, index: number) => {
              GridItem() {
                Text(title)
                  .fontSize(20)
                  .fontWeight(FontWeight.Bold)
                  .fontColor(this.getCurrentTheme().tableHeaderTextColor ?? this.getCurrentTheme().textColor)
                  .textAlign(TextAlign.Center)
                  .width('100%')
                  .height(50)
                  .padding(6)
                  .backgroundColor(this.getCurrentTheme().tableHeaderBg ?? this.getCurrentTheme().controlBg ?? this.getCurrentTheme().surfaceColor)
                  .border({ width: { right: 1, bottom: 1 }, color: this.getCurrentTheme().borderColor })
              }
            })
            
            // æ•°æ®è¡Œ
            ForEach(this.finishedProductsTableData, (row: string[], rowIndex: number) => {
              ForEach(row, (cell: string, colIndex: number) => {
                GridItem() {
                  Text(cell)
                    .fontSize(16)
                    .fontColor(this.getCurrentTheme().textColor)
                    .textAlign(TextAlign.Center)
                    .width('100%')
                    .height(65)
                    .padding(2)
                    .backgroundColor(this.getCurrentTheme().controlBg ?? this.getCurrentTheme().surfaceColor)
                    .border({ width: { right: 1, bottom: 1 }, color: this.getCurrentTheme().borderColor })
                }
              })
            })
          }
          .columnsTemplate('1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr')
          .columnsGap(0)
          .rowsGap(0)
          .width('100%')
          .height('75%')
          .backgroundColor(this.getCurrentTheme().surfaceColor)
        }
        .width('100%')
        .alignItems(HorizontalAlign.Start)
      }
      .width('100%')
      .backgroundColor(this.getCurrentTheme().controlBg ?? this.getCurrentTheme().surfaceColor)
      .border({ width: 1, color: this.getCurrentTheme().borderColor })
      .borderRadius(6)
      .padding(4)
      .margin({ top: 4, left: 4, right: 4, bottom: 2 })
      .alignItems(HorizontalAlign.Center)
      .justifyContent(FlexAlign.Center)
      }
    }
    .width('100%')
    .layoutWeight(1)
    .padding({ left: 16, right: 16, bottom: 16 })
  }

  build() {
    Column() {
      // TabBarå¯¼èˆª
      OmniTabBar({
        tabs: this.tabConfig,
        selectedTab: this.selectedTab,
        layoutDirection: TabBarDirection.HORIZONTAL,
        showSeparator: false,
        onTabClick: (tabKey: string) => {
          this.handleTabChange(tabKey)
        }
      })
      
      // å†…å®¹åŒºåŸŸ
      this.buildContent()
    }
    .width('100%')
    .height('100%')
    .backgroundColor(this.getCurrentTheme().pageBg ?? this.getCurrentTheme().backgroundColor)
  }
}
