import { AbilityConstant, ConfigurationConstant, UIAbility, Want } from '@kit.AbilityKit';
import common from '@ohos.app.ability.common';
import { hilog } from '@kit.PerformanceAnalysisKit';
import { window } from '@kit.ArkUI';
import { NetworkOptimizer } from '../utils/network/NetworkOptimizer';
import { startHttpServer, stopHttpServer, isHttpServerRunning } from '../utils/network/http/HttpServer';
import { HttpServerHandler } from '../utils/network/http/HttpServerHandler';
import { copyRawDirectoryAuto } from '../utils/FileUtils';
import { AppCleanup } from '../utils/lifecycle/AppCleanup';
import { ProcessingCurveFeed } from '../utils/data/ProcessingCurveFeed';
import { ProcessingBarFeed } from '../utils/data/ProcessingBarFeed';
import { MultiSeriesBarFeed } from '../utils/data/MultiSeriesBarFeed';
import { WavePhaseManager } from '../utils/ui/WavePhaseManager';
import { IBestORMInit } from '@ibestservices/ibest-orm';
import { relationalStore } from '@kit.ArkData';
import { DatabaseManager } from '../database/DatabaseManager';
import { User, TestModel, ProcessingHistory } from '../database';
import { UserData, TestData, ProcessingHistoryData } from '../database/types';

const DOMAIN = 0x0000;

// HTTP æœåŠ¡å™¨ç«¯å£é…ç½®
const HTTP_SERVER_PORT: number = 8080;

export default class EntryAbility extends UIAbility {
  private networkOptimizer: NetworkOptimizer = NetworkOptimizer.getInstance();
  private httpServerInitialized: boolean = false; // æ ‡è®° HTTP æœåŠ¡å™¨æ˜¯å¦å·²åˆå§‹åŒ–

  onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void {
    this.context.getApplicationContext().setColorMode(ConfigurationConstant.ColorMode.COLOR_MODE_NOT_SET);
    hilog.info(DOMAIN, 'testTag', '%{public}s', 'Ability onCreate');

    // å¤åˆ¶èµ„æºæ–‡ä»¶åˆ°å­˜å‚¨ç›®å½•ï¼ˆåº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€æ¬¡ï¼‰
    this.copyResourceFiles();
    
    // åˆå§‹åŒ–ç½‘ç»œä¼˜åŒ–å™¨
    this.initNetworkOptimizer();
    
    // å¯åŠ¨HTTPæœåŠ¡å™¨
    this.initHttpServer();
  }

  onDestroy(): void {
    hilog.info(DOMAIN, 'tes`tTag', '%{public}s', 'Ability onDestroy');

    // åœæ­¢ç½‘ç»œä¼˜åŒ–å™¨
    this.networkOptimizer.stop();
    
    // åœæ­¢HTTPæœåŠ¡å™¨ï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰
    if (isHttpServerRunning()) {
      stopHttpServer();
      this.httpServerInitialized = false; // é‡ç½®æ ‡è®°
      hilog.info(DOMAIN, 'EntryAbility', 'HTTPæœåŠ¡å™¨å·²åœæ­¢');
    }

    // ç»Ÿä¸€æ¸…ç†ï¼ˆå…œåº•ï¼‰
    AppCleanup.shutdownAll();
  }

  async onWindowStageCreate(windowStage: window.WindowStage): Promise<void> {
    // Main window is created, set main page for this ability
    hilog.info(DOMAIN, 'testTag', '%{public}s', 'Ability onWindowStageCreate');

    // åˆå§‹åŒ– IBest-ORM æ•°æ®åº“ï¼ˆå¿…é¡»åœ¨åŠ è½½é¡µé¢ä¹‹å‰å®Œæˆï¼‰
    try {
      await IBestORMInit(this.context, {
        name: "database.db",
        securityLevel: relationalStore.SecurityLevel.S1
      });
      hilog.info(DOMAIN, 'EntryAbility', 'IBest-ORM æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ');
      console.info('âœ… IBest-ORM æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ');
      
      // åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„
      const dbManager = DatabaseManager.getInstance();
      await dbManager.initDatabase();
      hilog.info(DOMAIN, 'EntryAbility', 'æ•°æ®åº“è¡¨ç»“æ„åˆå§‹åŒ–å®Œæˆ');
      console.info('âœ… æ•°æ®åº“è¡¨ç»“æ„åˆå§‹åŒ–å®Œæˆ');
      
      // æµ‹è¯•æ•°æ®åº“æ“ä½œï¼šæŸ¥è¯¢ç°æœ‰æ•°æ®
      console.info('ğŸ“Š ========== å¼€å§‹æ•°æ®åº“æŸ¥è¯¢æµ‹è¯• ==========');
      
      // æµ‹è¯•ç”¨æˆ·æ•°æ®
      console.info('ğŸ“‹ ========== ç”¨æˆ·æ•°æ®æµ‹è¯• ==========');
      const existingUsers: UserData[] = dbManager.getAllUsers();
      console.info(`ğŸ“‹ å½“å‰æ•°æ®åº“ä¸­çš„ç”¨æˆ·æ•°é‡: ${existingUsers.length}`);
      if (existingUsers.length > 0) {
        console.info('ğŸ“‹ ç°æœ‰ç”¨æˆ·æ•°æ®:');
        existingUsers.forEach((user: UserData, index: number) => {
          console.info(`  ç”¨æˆ· ${index + 1}: ID=${user.id}, Name=${user.Name}, Age=${user.Age}`);
        });
      } else {
        console.info('ğŸ“‹ ç”¨æˆ·è¡¨ä¸ºç©ºï¼Œæ­£åœ¨åˆ›å»ºæµ‹è¯•æ•°æ®...');
        // åˆ›å»ºä¸€äº›æµ‹è¯•æ•°æ®ï¼ˆä½¿ç”¨å®ä½“å¯¹è±¡ä¼ å‚ï¼‰
        dbManager.createUser(new User("æµ‹è¯•ç”¨æˆ·1", 25));
        dbManager.createUser(new User("æµ‹è¯•ç”¨æˆ·2", 30));
        dbManager.createUser(new User("æµ‹è¯•ç”¨æˆ·3", 28));
        console.info('âœ… æµ‹è¯•æ•°æ®åˆ›å»ºå®Œæˆ');
        
        // å†æ¬¡æŸ¥è¯¢éªŒè¯
        const newUsers: UserData[] = dbManager.getAllUsers();
        console.info(`ğŸ“‹ åˆ›å»ºåçš„ç”¨æˆ·æ•°é‡: ${newUsers.length}`);
        console.info('ğŸ“‹ æ‰€æœ‰ç”¨æˆ·æ•°æ®:');
        newUsers.forEach((user: UserData, index: number) => {
          console.info(`  ç”¨æˆ· ${index + 1}: ID=${user.id}, Name=${user.Name}, Age=${user.Age}`);
        });
        
        // æµ‹è¯•æŒ‰å¹´é¾„æŸ¥è¯¢
        const age25Users: UserData[] = dbManager.getUsersByAge(25);
        console.info(`ğŸ“‹ å¹´é¾„ä¸º25çš„ç”¨æˆ·æ•°é‡: ${age25Users.length}`);
        
        // æµ‹è¯•æŒ‰IDæŸ¥è¯¢
        if (newUsers.length > 0 && newUsers[0].id !== undefined) {
          const firstUser: UserData | null = dbManager.getUserById(newUsers[0].id);
          if (firstUser) {
            console.info(`ğŸ“‹ é€šè¿‡IDæŸ¥è¯¢åˆ°çš„ç”¨æˆ·: ID=${firstUser.id}, Name=${firstUser.Name}, Age=${firstUser.Age}`);
          }
        }
      }
      console.info('ğŸ“‹ ========== ç”¨æˆ·æ•°æ®æµ‹è¯•å®Œæˆ ==========');
      
      // æµ‹è¯• TestModel æ•°æ®
      console.info('ğŸ“‹ ========== æµ‹è¯•è¡¨æ•°æ®æµ‹è¯• ==========');
      const existingTestRecords: TestData[] = dbManager.getAllTestRecords();
      console.info(`ğŸ“‹ å½“å‰æ•°æ®åº“ä¸­çš„æµ‹è¯•è®°å½•æ•°é‡: ${existingTestRecords.length}`);
      if (existingTestRecords.length > 0) {
        console.info('ğŸ“‹ ç°æœ‰æµ‹è¯•è®°å½•æ•°æ®:');
        existingTestRecords.forEach((record: TestData, index: number) => {
          console.info(`  è®°å½• ${index + 1}: ID=${record.id}, Title=${record.Title}, Count=${record.Count}`);
        });
      } else {
        console.info('ğŸ“‹ æµ‹è¯•è¡¨ä¸ºç©ºï¼Œæ­£åœ¨åˆ›å»ºæµ‹è¯•æ•°æ®...');
        // åˆ›å»ºä¸€äº›æµ‹è¯•æ•°æ®ï¼ˆä½¿ç”¨å®ä½“å¯¹è±¡ä¼ å‚ï¼‰
        dbManager.createTestRecord(new TestModel("æµ‹è¯•æ ‡é¢˜1", "è¿™æ˜¯ç¬¬ä¸€ä¸ªæµ‹è¯•æè¿°", 10, 1));
        dbManager.createTestRecord(new TestModel("æµ‹è¯•æ ‡é¢˜2", "è¿™æ˜¯ç¬¬äºŒä¸ªæµ‹è¯•æè¿°", 20, 1));
        dbManager.createTestRecord(new TestModel("æµ‹è¯•æ ‡é¢˜3", "è¿™æ˜¯ç¬¬ä¸‰ä¸ªæµ‹è¯•æè¿°", 30, 0));
        console.info('âœ… æµ‹è¯•æ•°æ®åˆ›å»ºå®Œæˆ');
        
        // å†æ¬¡æŸ¥è¯¢éªŒè¯
        const newTestRecords: TestData[] = dbManager.getAllTestRecords();
        console.info(`ğŸ“‹ åˆ›å»ºåçš„æµ‹è¯•è®°å½•æ•°é‡: ${newTestRecords.length}`);
        console.info('ğŸ“‹ æ‰€æœ‰æµ‹è¯•è®°å½•æ•°æ®:');
        newTestRecords.forEach((record: TestData, index: number) => {
          console.info(`  è®°å½• ${index + 1}: ID=${record.id}`);
          console.info(`    æ ‡é¢˜: ${record.Title}`);
          console.info(`    æè¿°: ${record.Description}`);
          console.info(`    æ•°é‡: ${record.Count}`);
          console.info(`    å¯ç”¨: ${record.IsEnabled}`);
        });
      }
      console.info('ğŸ“‹ ========== æµ‹è¯•è¡¨æ•°æ®æµ‹è¯•å®Œæˆ ==========');
      
      // æµ‹è¯•å†å²åŠ å·¥æ•°æ®
      console.info('ğŸ“‹ ========== å†å²åŠ å·¥æ•°æ®æµ‹è¯• ==========');
      const existingHistory: ProcessingHistoryData[] = dbManager.getAllProcessingHistory();
      console.info(`ğŸ“‹ å½“å‰æ•°æ®åº“ä¸­çš„å†å²åŠ å·¥è®°å½•æ•°é‡: ${existingHistory.length}`);
      if (existingHistory.length > 0) {
        console.info('ğŸ“‹ ç°æœ‰å†å²åŠ å·¥è®°å½•æ•°æ®:');
        existingHistory.forEach((record: ProcessingHistoryData, index: number) => {
          console.info(`  è®°å½• ${index + 1}: ID=${record.id}`);
          console.info(`    å®¢æˆ·åç§°: ${record.CustomerName}`);
          console.info(`    å†œåœºåç§°: ${record.FarmName}`);
          console.info(`    æ°´æœåç§°: ${record.FruitName}`);
          console.info(`    çŠ¶æ€: ${record.Status}`);
          console.info(`    å¼€å§‹æ—¶é—´: ${record.StartTime}`);
          console.info(`    ç»“æŸæ—¶é—´: ${record.EndTime}`);
          console.info(`    é‡é‡: ${record.Weight}`);
          console.info(`    æ•°é‡: ${record.Quantity}`);
        });
      } else {
        console.info('ğŸ“‹ å†å²åŠ å·¥è¡¨ä¸ºç©ºï¼Œæ­£åœ¨åˆ›å»ºæµ‹è¯•æ•°æ®...');
        // åˆ›å»ºä¸€äº›æµ‹è¯•æ•°æ®
        const now = new Date();
        const startTime = new Date(now.getTime() - 2 * 60 * 60 * 1000); // 2å°æ—¶å‰
        const endTime = new Date(now.getTime() - 30 * 60 * 1000); // 30åˆ†é’Ÿå‰
        
        const formatDateTime = (date: Date): string => {
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          const hours = String(date.getHours()).padStart(2, '0');
          const minutes = String(date.getMinutes()).padStart(2, '0');
          const seconds = String(date.getSeconds()).padStart(2, '0');
          return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        };
        
        // åˆ›å»ºä¸€äº›æµ‹è¯•æ•°æ®ï¼ˆä½¿ç”¨å®ä½“å¯¹è±¡ä¼ å‚ï¼‰
        dbManager.createProcessingHistory(new ProcessingHistory(
          "å®¢æˆ·A",
          "é˜³å…‰å†œåœº",
          "è‹¹æœ",
          "å·²å®Œæˆ",
          formatDateTime(startTime),
          formatDateTime(endTime),
          1500.5,
          100
        ));
        
        dbManager.createProcessingHistory(new ProcessingHistory(
          "å®¢æˆ·B",
          "ç»¿è‰²å†œåœº",
          "æ©™å­",
          "è¿›è¡Œä¸­",
          formatDateTime(now),
          "",  // è¿›è¡Œä¸­çš„ä»»åŠ¡ï¼Œç»“æŸæ—¶é—´ä¸ºç©ºå­—ç¬¦ä¸²
          800.0,
          50
        ));
        
        dbManager.createProcessingHistory(new ProcessingHistory(
          "å®¢æˆ·C",
          "ä¸°æ”¶å†œåœº",
          "é¦™è•‰",
          "å·²å®Œæˆ",
          formatDateTime(new Date(now.getTime() - 5 * 60 * 60 * 1000)),
          formatDateTime(new Date(now.getTime() - 3 * 60 * 60 * 1000)),
          2000.0,
          200
        ));
        
        console.info('âœ… å†å²åŠ å·¥æµ‹è¯•æ•°æ®åˆ›å»ºå®Œæˆ');
        
        // å†æ¬¡æŸ¥è¯¢éªŒè¯
        const newHistory: ProcessingHistoryData[] = dbManager.getAllProcessingHistory();
        console.info(`ğŸ“‹ åˆ›å»ºåçš„å†å²åŠ å·¥è®°å½•æ•°é‡: ${newHistory.length}`);
        console.info('ğŸ“‹ æ‰€æœ‰å†å²åŠ å·¥è®°å½•æ•°æ®:');
        newHistory.forEach((record: ProcessingHistoryData, index: number) => {
          console.info(`  è®°å½• ${index + 1}: ID=${record.id}`);
          console.info(`    å®¢æˆ·åç§°: ${record.CustomerName}`);
          console.info(`    å†œåœºåç§°: ${record.FarmName}`);
          console.info(`    æ°´æœåç§°: ${record.FruitName}`);
          console.info(`    çŠ¶æ€: ${record.Status}`);
          console.info(`    å¼€å§‹æ—¶é—´: ${record.StartTime}`);
          console.info(`    ç»“æŸæ—¶é—´: ${record.EndTime}`);
          console.info(`    é‡é‡: ${record.Weight}`);
          console.info(`    æ•°é‡: ${record.Quantity}`);
        });
      }
      console.info('ğŸ“‹ ========== å†å²åŠ å·¥æ•°æ®æµ‹è¯•å®Œæˆ ==========');
      console.info('ğŸ“Š ========== æ•°æ®åº“æŸ¥è¯¢æµ‹è¯•å®Œæˆ ==========');
    } catch (e) {
      hilog.error(DOMAIN, 'EntryAbility', `æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥: ${JSON.stringify(e)}`);
      console.error('âŒ æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥:', e);
    }

    windowStage.loadContent('pages/Home', async (err) => { // ä¿®æ”¹è¿›å…¥çš„ä¸»é¡µ
      if (err.code) {
        hilog.error(DOMAIN, 'testTag', 'Failed to load the content. Cause: %{public}s', JSON.stringify(err));
        return;
      }
      hilog.info(DOMAIN, 'testTag', 'Succeeded in loading the content.');
      try {
        const mainWindow: window.Window = await windowStage.getMainWindow();
        // å…¨å±å¸ƒå±€ï¼Œéšè—ç³»ç»Ÿæ ‡é¢˜æ 
        await mainWindow.setWindowLayoutFullScreen(true);
        await mainWindow.setFullScreen(true);
      } catch (e) {
        hilog.error(DOMAIN, 'testTag', `set non-fullscreen failed: ${JSON.stringify(e)}`);
      }
    });
  }

  onWindowStageDestroy(): void {
    // Main window is destroyed, release UI related resources
    hilog.info(DOMAIN, 'testTag', '%{public}s', 'Ability onWindowStageDestroy');
  }

  onForeground(): void {
    // Ability has brought to foreground
    hilog.info(DOMAIN, 'testTag', '%{public}s', 'Ability onForeground');
  }

  onBackground(): void {
    // Ability has back to background
    hilog.info(DOMAIN, 'testTag', '%{public}s', 'Ability onBackground');
    
    // è¿›å…¥åå°æ—¶ç«‹å³åœæ­¢æ‰€æœ‰å®šæ—¶å™¨å’ŒåŠ¨ç”»ï¼Œé¿å…é˜»å¡ç³»ç»Ÿæ“ä½œ
    // ä½¿ç”¨å¼‚æ­¥æ‰§è¡Œï¼Œé¿å…é˜»å¡ onBackground å›è°ƒï¼ˆç³»ç»Ÿåœ¨ onBackground ä¸­ä¼šæ‰§è¡Œå¸§ç‡è®¾ç½®ç­‰æ“ä½œï¼‰
    // æ³¨æ„ï¼šå¿…é¡»åœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œï¼Œä¸èƒ½åœ¨ onBackground ä¸­åŒæ­¥æ‰§è¡Œï¼Œå¦åˆ™ä¼šé˜»å¡ç³»ç»Ÿæ“ä½œ
    Promise.resolve().then(() => {
      try {
        // åœæ­¢å…¨å±€æ•°æ®æºçš„å®šæ—¶å™¨
        ProcessingCurveFeed.getInstance().stop();
        ProcessingBarFeed.getInstance().stop();
        MultiSeriesBarFeed.getInstance().stop();
        WavePhaseManager.getInstance().stop();
        
        hilog.info(DOMAIN, 'EntryAbility', 'åå°æ¸…ç†ï¼šå·²åœæ­¢æ‰€æœ‰å…¨å±€å®šæ—¶å™¨');
      } catch (e) {
        hilog.error(DOMAIN, 'EntryAbility', `åå°æ¸…ç†å¤±è´¥: ${JSON.stringify(e)}`);
      }
    });
  }

  onStop(): void {
    // Ability åœæ­¢å‰åšç»Ÿä¸€æ¸…ç†ï¼ˆç½‘ç»œ/å®šæ—¶å™¨/è¿æ¥ï¼‰
    hilog.info(DOMAIN, 'EntryAbility', 'onStop: æ‰§è¡Œå…¨å±€æ¸…ç†');
    // åŒæ­¥è§¦å‘æ¸…ç†ï¼ˆæ— éœ€ awaitï¼Œé¿å…é˜»å¡ç”Ÿå‘½å‘¨æœŸï¼‰
    // å¦‚éœ€ä¸¥æ ¼ç¡®ä¿å®Œæˆï¼Œå¯æ”¹ä¸º async å¹¶ awaitã€‚
    AppCleanup.shutdownAll();
  }

   // åˆå§‹åŒ–ç½‘ç»œä¼˜åŒ–å™¨
  private async initNetworkOptimizer() {
    try {
      hilog.info(DOMAIN, 'EntryAbility', 'å¼€å§‹åˆå§‹åŒ–ç½‘ç»œä¼˜åŒ–å™¨');

      // åˆå§‹åŒ–ç½‘ç»œä¼˜åŒ–å™¨
      const success = await this.networkOptimizer.initialize();
      if (success) {
        hilog.info(DOMAIN, 'EntryAbility', 'ç½‘ç»œä¼˜åŒ–å™¨åˆå§‹åŒ–æˆåŠŸ');
      } else {
        hilog.error(DOMAIN, 'EntryAbility', 'ç½‘ç»œä¼˜åŒ–å™¨åˆå§‹åŒ–å¤±è´¥');
      }
    } catch (error) {
      hilog.error(DOMAIN, 'EntryAbility', `ç½‘ç»œä¼˜åŒ–å™¨åˆå§‹åŒ–å¼‚å¸¸: ${error.message}`);
    }
  }

  // åˆå§‹åŒ–HTTPæœåŠ¡å™¨ï¼ˆç¡®ä¿åªæ‰§è¡Œä¸€æ¬¡ï¼‰
  private async initHttpServer() {
    // é˜²æ­¢é‡å¤å¯åŠ¨ï¼šæ£€æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–æˆ–å·²åœ¨è¿è¡Œ
    if (this.httpServerInitialized) {
      hilog.warn(DOMAIN, 'EntryAbility', 'HTTPæœåŠ¡å™¨å·²ç»åˆå§‹åŒ–è¿‡ï¼Œè·³è¿‡é‡å¤å¯åŠ¨');
      return;
    }
    
    if (isHttpServerRunning()) {
      hilog.warn(DOMAIN, 'EntryAbility', 'HTTPæœåŠ¡å™¨å·²ç»åœ¨è¿è¡Œä¸­ï¼Œè·³è¿‡é‡å¤å¯åŠ¨');
      this.httpServerInitialized = true;
      return;
    }
    
    try {
      hilog.info(DOMAIN, 'EntryAbility', 'å¼€å§‹å¯åŠ¨HTTPæœåŠ¡å™¨');
      
      // è®¾ç½®æ–‡ä»¶æµè§ˆåŸºç¡€è·¯å¾„
      HttpServerHandler.setFileBasePath(this.context);
      
      // ä½¿ç”¨HttpServerHandleråˆ›å»ºå¤„ç†å™¨
      // å¯ä»¥é€‰æ‹©ä½¿ç”¨é»˜è®¤å¤„ç†å™¨æˆ–è·¯ç”±å¤„ç†å™¨
      // const handler = HttpServerHandler.createHandler(); // ç®€å•å¤„ç†å™¨
      const handler = HttpServerHandler.createRouterHandler(); // å¸¦è·¯ç”±åŠŸèƒ½çš„å¤„ç†å™¨
      
      // å¯åŠ¨HTTPæœåŠ¡å™¨
      await startHttpServer(HTTP_SERVER_PORT, handler);
      
      // æ ‡è®°ä¸ºå·²åˆå§‹åŒ–
      this.httpServerInitialized = true;
      hilog.info(DOMAIN, 'EntryAbility', `HTTPæœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œç›‘å¬ç«¯å£: ${HTTP_SERVER_PORT}`);
    } catch (error) {
      hilog.error(DOMAIN, 'EntryAbility', `HTTPæœåŠ¡å™¨å¯åŠ¨å¤±è´¥: ${error.message}`);
      // å¯åŠ¨å¤±è´¥æ—¶é‡ç½®æ ‡è®°ï¼Œå…è®¸ä¸‹æ¬¡é‡è¯•
      this.httpServerInitialized = false;
    }
  }

  // å¤åˆ¶èµ„æºæ–‡ä»¶åˆ°å­˜å‚¨ç›®å½•ï¼ˆè‡ªåŠ¨éå†æ•´ä¸ªç›®å½•ï¼‰
  private async copyResourceFiles() {
    try {
      hilog.info(DOMAIN, 'EntryAbility', 'å¼€å§‹è‡ªåŠ¨å¤åˆ¶èµ„æºæ–‡ä»¶...');
      
      // ä½¿ç”¨è‡ªåŠ¨éå†åŠŸèƒ½ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤æ–‡ä»¶åˆ—è¡¨
      // ä¼šè‡ªåŠ¨æ‰«æ rawfile/file ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬å­ç›®å½•ï¼‰
      const result = await copyRawDirectoryAuto(
        this.context,
        'file',           // rawfile ä¸­çš„æ–‡ä»¶å¤¹è·¯å¾„
        undefined,         // ä½¿ç”¨é…ç½®ä¸­çš„é»˜è®¤è·¯å¾„
        'file'             // ç›®æ ‡æ–‡ä»¶å¤¹åï¼ˆå¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨åŸæ–‡ä»¶å¤¹åï¼‰
      );
      
      hilog.info(DOMAIN, 'EntryAbility', `èµ„æºæ–‡ä»¶å¤åˆ¶æˆåŠŸ: ${result.fileCount} ä¸ªæ–‡ä»¶å·²å¤åˆ¶åˆ° ${result.targetPath}`);
      hilog.info(DOMAIN, 'EntryAbility', `å¤åˆ¶çš„æ–‡ä»¶åˆ—è¡¨: ${result.fileList.join(', ')}`);
    } catch (error) {
      hilog.error(DOMAIN, 'EntryAbility', `èµ„æºæ–‡ä»¶å¤åˆ¶å¤±è´¥: ${error instanceof Error ? error.message : JSON.stringify(error)}`);
    }
  }
}
